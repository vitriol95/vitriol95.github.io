<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="스프링 mvc 프로젝트 + AWS EC2에 빌드까지(4)" /><meta property="og:locale" content="ko" /><meta name="description" content="이전 글" /><meta property="og:description" content="이전 글" /><link rel="canonical" href="https://vitriol95.github.io/posts/mvcproject4/" /><meta property="og:url" content="https://vitriol95.github.io/posts/mvcproject4/" /><meta property="og:site_name" content="Vitriol" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-04T11:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="스프링 mvc 프로젝트 + AWS EC2에 빌드까지(4)" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="QsbP4NOwVkaE8CnHpYOl-qNGhxB9m1RbsrBEefA92ao" /> <script type="application/ld+json"> {"headline":"스프링 mvc 프로젝트 + AWS EC2에 빌드까지(4)","dateModified":"2021-06-28T18:55:29+09:00","datePublished":"2021-06-04T11:00:00+09:00","description":"이전 글","url":"https://vitriol95.github.io/posts/mvcproject4/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://vitriol95.github.io/posts/mvcproject4/"},"@context":"https://schema.org"}</script><title>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(4) | Vitriol</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Vitriol"><meta name="application-name" content="Vitriol"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WSY4XYN711"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WSY4XYN711'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Vitriol</a></div><div class="site-subtitle font-italic">기억을 적는 시간</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/vitriol95" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['vitriol951','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(4)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(4)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> vitriol </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Fri, Jun 4, 2021, 11:00 AM +0900" prep="on" > Jun 4, 2021 <i class="unloaded">2021-06-04T11:00:00+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Jun 28, 2021, 6:55 PM +0900" prefix="Updated " > Jun 28, 2021 <i class="unloaded">2021-06-28T18:55:29+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2943 words">16 min</span></div></div><div class="post-content"><h1 id="이전-글">이전 글</h1><p><a href="https://vitriol95.github.io/posts/mvcproject3/">이전글</a> 에서는 Post 엔티티를 정의하고 이를 등록, 수정, 삭제하는 과정을 진행하였다. 이번 시간에는 저번 시간에 이어 부족한 부분들을 채워보고, 테스트를 진행한뒤, Reply엔티티까지 만들어 보겠다.</p><hr /><h1 id="account-정보-수정관련-추가">Account 정보 수정관련 추가</h1><p>이전 닉네임을 변경할 때, ProfileFormValidator 라는 클래스의 validate (Overriding)메서드를 이용하였다. 하지만 여기서 문제가 발생하는데, 쓰던 닉네임을 그대로 입력했을 때에도 중복체크가 되어 걸리는 것이다. 따라서 validate 메서드를 다음과 같이 수정하였다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProfileFormValidator</span> <span class="kd">implements</span> <span class="nc">Validator</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">AccountRepository</span> <span class="n">accountRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supports</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">clazz</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="nc">ProfileForm</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">validate</span><span class="o">(</span><span class="nc">Object</span> <span class="n">target</span><span class="o">,</span> <span class="nc">Errors</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ProfileForm</span> <span class="n">profileForm</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ProfileForm</span><span class="o">)</span> <span class="n">target</span><span class="o">;</span>
        <span class="nc">Account</span> <span class="n">byNickname</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByNickname</span><span class="o">(</span><span class="n">profileForm</span><span class="o">.</span><span class="na">getNickname</span><span class="o">());</span>

        <span class="k">if</span> <span class="o">(</span><span class="n">changeNickname</span><span class="o">(</span><span class="n">profileForm</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">byNickname</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">errors</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">"nickname"</span><span class="o">,</span><span class="s">"wrong.value"</span><span class="o">,</span><span class="s">"해당 닉네임을 이미 사용중입니다."</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="nf">changeNickname</span><span class="o">(</span><span class="nc">ProfileForm</span> <span class="n">profileForm</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">UserAccount</span> <span class="n">principal</span> <span class="o">=</span> <span class="o">(</span><span class="nc">UserAccount</span><span class="o">)</span> <span class="nc">SecurityContextHolder</span><span class="o">.</span><span class="na">getContext</span><span class="o">().</span><span class="na">getAuthentication</span><span class="o">().</span><span class="na">getPrincipal</span><span class="o">();</span>
        <span class="k">return</span> <span class="o">!</span><span class="n">profileForm</span><span class="o">.</span><span class="na">getNickname</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">principal</span><span class="o">.</span><span class="na">getAccount</span><span class="o">().</span><span class="na">getNickname</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><br /> changeNickname 이라는 메서드를 추가하여 현재 사용중인 닉네임과의 일치를 확인해 보았다. 변경하기 전 상태의 로그인 되어있는 principal의 닉네임을 가져와 매칭을 진행하였다.</p><hr /><h1 id="글-작성시-account-객체에-대한-영속성-문제">글 작성시 Account 객체에 대한 영속성 문제</h1><p>이전, 새 글을 작성할때의 핸들러와 서비스단을 살펴보자. 한가지 문제가 존재한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">// PostController.class</span>

<span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/new-post"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">postFormSubmit</span><span class="o">(</span><span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">,</span> <span class="nd">@Valid</span> <span class="nc">NewPostForm</span> <span class="n">newPostForm</span><span class="o">,</span> <span class="nc">Errors</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span> <span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"post/form"</span><span class="o">;</span>
    <span class="o">}</span>
    <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postService</span><span class="o">.</span><span class="na">createNewPost</span><span class="o">(</span><span class="n">modelMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">newPostForm</span><span class="o">,</span> <span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">account</span><span class="o">);</span>
    <span class="k">return</span> <span class="s">"redirect:/posts/"</span> <span class="o">+</span> <span class="n">post</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
<span class="o">}</span>

<span class="c1">//PostService.class</span>

<span class="kd">public</span> <span class="nc">Post</span> <span class="nf">createNewPost</span><span class="o">(</span><span class="nc">Post</span> <span class="n">newPost</span><span class="o">,</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">newPost</span><span class="o">);</span>
    <span class="n">post</span><span class="o">.</span><span class="na">setWriter</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">post</span><span class="o">;</span>
<span class="o">}</span>

</pre></table></code></div></div><p>post가 가지고있는 외래키에 해당하는 account의 매핑을 해주는 과정에 해당한다. 이때의 Account는 어떠한 상태인지 파악이 필요하다.</p><p><br /> 늦게 알아차린 이유는 항상 회원가입한 후 바로 글 작성을 하여 테스트를 했기 때문이다. 이 때의 account는 managed 상태에 해당한다. 하지만, <strong>로그인 한 뒤, 글쓰기를 진행할 경우</strong> 이때의 account는 detached 상태이므로 17번째 라인은 유효하지 않다. 즉, <strong>프록시 객체를 던져준 꼴이된다</strong>.</p><p><br /> 따라서 이 Account 객체를 다시 managed 상태로 만들어 줄 필요가 있다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">//PostService.class 수정</span>
<span class="kd">public</span> <span class="nc">Post</span> <span class="nf">createNewPost</span><span class="o">(</span><span class="nc">Post</span> <span class="n">newPost</span><span class="o">,</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>

    <span class="nc">Account</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
    <span class="c1">// Detached 상태를 깨워주기</span>

    <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">newPost</span><span class="o">);</span>
    <span class="n">post</span><span class="o">.</span><span class="na">setWriter</span><span class="o">(</span><span class="n">writer</span><span class="o">);</span>
    <span class="k">return</span> <span class="n">post</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>4번라인처럼 Detached 상태를 벗어나게 끔 해주어야 한다.</p></blockquote><hr /><h1 id="이전-시간-핸들러들에-대한-단위-테스트-진행">이전 시간 핸들러들에 대한 단위 테스트 진행</h1><h2 id="회원-정보-수정테스트">회원 정보 수정테스트</h2><p>회원 정보를 수정하는 핸들러들에 대한 테스트를 진행하기 전에, 이곳부터는 Spring Security가 적용되는 구간임을 인지해야 한다. 따라서 이전에 진행했던 (회원가입, 로그인) 테스트와는 달리 <code class="language-plaintext highlighter-rouge">@WithUserDetails</code> 어노테이션을 적용하여 컨텍스트내 Principal 객체를 주입하여 진행하려한다.</p><p><br /> 회원 정보를 변경하는 테스트는 다음과 같다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="nd">@SpringBootTest</span>
<span class="nd">@AutoConfigureMockMvc</span>
<span class="kd">class</span> <span class="nc">AccountControllerTest</span> <span class="o">{</span>

    <span class="cm">/**
    이전 코드들
    */</span>

    <span class="nd">@BeforeEach</span>
    <span class="kt">void</span> <span class="nf">beforeEach</span><span class="o">()</span> <span class="o">{</span>

        <span class="cm">/**
        이전 코드들
        */</span>

        <span class="nc">SignUpForm</span> <span class="n">signUpForm2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SignUpForm</span><span class="o">();</span>
        <span class="n">signUpForm2</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"test@naver.com"</span><span class="o">);</span>
        <span class="n">signUpForm2</span><span class="o">.</span><span class="na">setNickname</span><span class="o">(</span><span class="s">"test"</span><span class="o">);</span>
        <span class="n">signUpForm2</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"12345678"</span><span class="o">);</span>
        <span class="n">accountService</span><span class="o">.</span><span class="na">createNewAccount</span><span class="o">(</span><span class="n">signUpForm2</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="c1">// ------ 설정 관련 ------ //</span>
    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"회원 정보 변경 뷰"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">회원_정보_변경_뷰</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/settings"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"account/settings"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"profileForm"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"account"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">authenticated</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"회원 정보 변경 - 입력값 정상"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">회원_정보_변경_입력값_정상</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/settings"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"nickname"</span><span class="o">,</span> <span class="s">"vitriol951"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"bio"</span><span class="o">,</span> <span class="s">"bio"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is3xxRedirection</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">redirectedUrl</span><span class="o">(</span><span class="s">"/settings"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"redirect:/settings"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">flash</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"message"</span><span class="o">));</span> 

        <span class="nc">Account</span> <span class="n">vitriol</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="s">"vitriol95@naver.com"</span><span class="o">);</span>

        <span class="n">assertThat</span><span class="o">(</span><span class="n">vitriol</span><span class="o">.</span><span class="na">getNickname</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"vitriol951"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">vitriol</span><span class="o">.</span><span class="na">getBio</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"bio"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">vitriol</span><span class="o">.</span><span class="na">getModifiedDate</span><span class="o">()).</span><span class="na">isAfter</span><span class="o">(</span><span class="n">vitriol</span><span class="o">.</span><span class="na">getCreatedDate</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"회원 정보 변경 - 정상 - 닉네임 그대로"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">회원_정보_변경_닉네임_그대로</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/settings"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"nickname"</span><span class="o">,</span> <span class="s">"vitriol95"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"bio"</span><span class="o">,</span> <span class="s">"bio"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is3xxRedirection</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">redirectedUrl</span><span class="o">(</span><span class="s">"/settings"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"redirect:/settings"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">flash</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"message"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"회원 정보 변경 - 실패 - 중복 닉네임"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">회원_정보_변경_실패_중복_닉네임</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/settings"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"nickname"</span><span class="o">,</span> <span class="s">"test"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"bio"</span><span class="o">,</span> <span class="s">"bio"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"account/settings"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"회원 정보 변경 - 입력값 오류"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">회원_정보_변경_입력값_오류</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/settings"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"nickname"</span><span class="o">,</span> <span class="s">"vitriol95vitriol95vitriol95itriol95itriol95itriol95itriol95itriol95"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"bio"</span><span class="o">,</span> <span class="s">"bio"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"account/settings"</span><span class="o">));</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>@WithUserDetails의 value값은 BeforeEach를 통해 미리 생성한 Account객체를 배정하였다. 두번째 param의 의미는 본 테스트 메서드를 진행할 때만 시큐리티 컨텍스트객체를 이용한다는 뜻이다. (@Before / AfterEach 과정에는 포함되지 않는다.)</p></blockquote><p>게시글에 대한 테스트는 다음과 같다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span>
<span class="nd">@AutoConfigureMockMvc</span>
<span class="nd">@SpringBootTest</span>
<span class="kd">class</span> <span class="nc">PostControllerTest</span> <span class="o">{</span>

    <span class="nd">@Autowired</span>
    <span class="nc">AccountService</span> <span class="n">accountService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="nc">AccountRepository</span> <span class="n">accountRepository</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="nc">MockMvc</span> <span class="n">mockMvc</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="nc">PostService</span> <span class="n">postService</span><span class="o">;</span>

    <span class="nd">@Autowired</span>
    <span class="nc">PostRepository</span> <span class="n">postRepository</span><span class="o">;</span>

    <span class="nd">@BeforeEach</span>
    <span class="kt">void</span> <span class="nf">beforeEach</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">SignUpForm</span> <span class="n">signUpForm</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SignUpForm</span><span class="o">();</span>
        <span class="n">signUpForm</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"vitriol95@naver.com"</span><span class="o">);</span>
        <span class="n">signUpForm</span><span class="o">.</span><span class="na">setNickname</span><span class="o">(</span><span class="s">"vitriol95"</span><span class="o">);</span>
        <span class="n">signUpForm</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"12345678"</span><span class="o">);</span>
        <span class="n">accountService</span><span class="o">.</span><span class="na">createNewAccount</span><span class="o">(</span><span class="n">signUpForm</span><span class="o">);</span>

        <span class="nc">SignUpForm</span> <span class="n">signUpForm2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">SignUpForm</span><span class="o">();</span>
        <span class="n">signUpForm2</span><span class="o">.</span><span class="na">setEmail</span><span class="o">(</span><span class="s">"vitriol95@gmail.com"</span><span class="o">);</span>
        <span class="n">signUpForm2</span><span class="o">.</span><span class="na">setNickname</span><span class="o">(</span><span class="s">"vitriol951"</span><span class="o">);</span>
        <span class="n">signUpForm2</span><span class="o">.</span><span class="na">setPassword</span><span class="o">(</span><span class="s">"12345678"</span><span class="o">);</span>
        <span class="n">accountService</span><span class="o">.</span><span class="na">createNewAccount</span><span class="o">(</span><span class="n">signUpForm2</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@AfterEach</span>
    <span class="kt">void</span> <span class="nf">afterEach</span><span class="o">()</span> <span class="o">{</span>
        <span class="n">postRepository</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">();</span>
        <span class="n">accountRepository</span><span class="o">.</span><span class="na">deleteAll</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"포스트 작성 뷰"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">포스트_작성_뷰</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/new-post"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"post/form"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"account"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"newPostForm"</span><span class="o">));</span>

    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"포스트 작성 - 입력값 정상"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">포스트_작성_입력값_정상</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="nc">MvcResult</span> <span class="n">mvcResult</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/new-post"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="s">"TestTitle"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"introduction"</span><span class="o">,</span> <span class="s">"TestIntroduction"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"description"</span><span class="o">,</span> <span class="s">"TestDescription"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"open"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is3xxRedirection</span><span class="o">()).</span><span class="na">andReturn</span><span class="o">();</span>

        <span class="nc">String</span><span class="o">[]</span> <span class="n">url</span> <span class="o">=</span> <span class="n">mvcResult</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getRedirectedUrl</span><span class="o">().</span><span class="na">split</span><span class="o">(</span><span class="s">"/"</span><span class="o">);</span>
        <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="nc">Long</span><span class="o">.</span><span class="na">parseLong</span><span class="o">(</span><span class="n">url</span><span class="o">[</span><span class="n">url</span><span class="o">.</span><span class="na">length</span> <span class="o">-</span> <span class="mi">1</span><span class="o">]);</span> <span class="c1">// redirected id 가져오기</span>

        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">findPostWithAccountById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
        <span class="nc">Account</span> <span class="n">vitriol</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="s">"vitriol95@naver.com"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">vitriol</span><span class="o">.</span><span class="na">getPosts</span><span class="o">()).</span><span class="na">contains</span><span class="o">(</span><span class="n">post</span><span class="o">);</span> <span class="c1">// account 내에 저장되었는가?</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">isWriter</span><span class="o">(</span><span class="n">vitriol</span><span class="o">)).</span><span class="na">isTrue</span><span class="o">();</span> <span class="c1">// 글쓴이가 맞는가?</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"포스트 작성 - 입력값 오류"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">포스트_작성_입력값_오류</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/new-post"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="s">"TestTitle"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"introduction"</span><span class="o">,</span> <span class="s">"TestIntroduction"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"description"</span><span class="o">,</span> <span class="s">""</span><span class="o">)</span> <span class="c1">// 본문이 없음</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"open"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"post/form"</span><span class="o">));</span>

        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">findPostWithAccountById</span><span class="o">(</span><span class="mi">1L</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">).</span><span class="na">isNull</span><span class="o">();</span>
        <span class="nc">Account</span> <span class="n">vitriol</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="s">"vitriol95@naver.com"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">vitriol</span><span class="o">.</span><span class="na">getPosts</span><span class="o">()).</span><span class="na">doesNotContain</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
    <span class="o">}</span>


    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"포스트 상세보기 뷰 - 글쓴이가 봤을 때"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">포스트_상세보기_뷰_글쓴이가_봤을_때</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="nc">Account</span> <span class="n">vitriol</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="s">"vitriol95@naver.com"</span><span class="o">);</span>
        <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">new_post</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="n">vitriol</span><span class="o">);</span>

        <span class="nc">MvcResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/posts/"</span><span class="o">+</span><span class="n">id</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"post/view"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"account"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"post"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andReturn</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getContentAsString</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">body</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s">"수정"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">body</span><span class="o">).</span><span class="na">contains</span><span class="o">(</span><span class="s">"삭제"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@gmail.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"포스트 상세보기 뷰 - 글쓴이 아닌 사람이 봤을 때"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">포스트_상세보기_뷰_글쓴이_아닌_사람이_봤을_때</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">Account</span> <span class="n">vitriol</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="s">"vitriol95@naver.com"</span><span class="o">);</span>
        <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">new_post</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="n">vitriol</span><span class="o">);</span>

        <span class="nc">MvcResult</span> <span class="n">result</span> <span class="o">=</span> <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/posts/"</span><span class="o">+</span><span class="n">id</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"post/view"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"account"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"post"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andReturn</span><span class="o">();</span>
        <span class="nc">String</span> <span class="n">body</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getResponse</span><span class="o">().</span><span class="na">getContentAsString</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">body</span><span class="o">).</span><span class="na">doesNotContain</span><span class="o">(</span><span class="s">"수정"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">body</span><span class="o">).</span><span class="na">doesNotContain</span><span class="o">(</span><span class="s">"삭제"</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"포스트 업데이트 뷰 - 글쓴이가 봤을 때"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">포스트_업데이트_뷰_글쓴이</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">Account</span> <span class="n">vitriol</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="s">"vitriol95@naver.com"</span><span class="o">);</span>
        <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">new_post</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="n">vitriol</span><span class="o">);</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/posts/"</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">"/update"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"post/update"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"newPostForm"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">model</span><span class="o">().</span><span class="na">attributeExists</span><span class="o">(</span><span class="s">"account"</span><span class="o">));</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@gmail.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"포스트 상세보기 뷰 - 글쓴이 아닌 사람이 접근불가"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">포스트_업데이트_뷰_글쓴이_아닌_사람_접근불가</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>
        <span class="nc">Account</span> <span class="n">vitriol</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="s">"vitriol95@naver.com"</span><span class="o">);</span>
        <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">new_post</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="n">vitriol</span><span class="o">);</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">get</span><span class="o">(</span><span class="s">"/posts/"</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">"/update"</span><span class="o">))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is4xxClientError</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"포스트 업데이트 - 입력값 정상"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">포스트_업데이트_입력값_정상</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">vitriol95Post</span><span class="o">();</span>
        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/posts/"</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">"/update"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="s">"newTestTitle"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"introduction"</span><span class="o">,</span> <span class="s">"newIntroduction"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"description"</span><span class="o">,</span> <span class="s">"description"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"open"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is3xxRedirection</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"redirect:/posts/"</span> <span class="o">+</span> <span class="n">id</span><span class="o">));</span>

        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">findPostWithAccountById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">).</span><span class="na">isNotNull</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getAccount</span><span class="o">().</span><span class="na">getEmail</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"vitriol95@naver.com"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getTitle</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"newTestTitle"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getIntroduction</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"newIntroduction"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getDescription</span><span class="o">()).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">isOpen</span><span class="o">()).</span><span class="na">isTrue</span><span class="o">();</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getModifiedDate</span><span class="o">()).</span><span class="na">isAfter</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">getCreatedDate</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"포스트 업데이트 - 입력값 오류"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">포스트_업데이트_입력값_오류</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">vitriol95Post</span><span class="o">();</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/posts/"</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">"/update"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"title"</span><span class="o">,</span> <span class="s">"50글자넘기면안됨50글자넘기면안됨50글자넘기면안됨50글자넘기면안됨50글자넘기면안됨50글자넘기면안됨50글자넘기면안됨50글자넘기면안됨50글자넘기면안됨50글자넘기면안됨50글자넘기면안됨50글자넘기면안됨"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"introduction"</span><span class="o">,</span> <span class="s">"intro"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"description"</span><span class="o">,</span> <span class="s">"description"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"open"</span><span class="o">,</span> <span class="nc">String</span><span class="o">.</span><span class="na">valueOf</span><span class="o">(</span><span class="kc">true</span><span class="o">))</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">isOk</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">view</span><span class="o">().</span><span class="na">name</span><span class="o">(</span><span class="s">"post/update"</span><span class="o">));</span>

    <span class="o">}</span>

    <span class="nd">@WithUserDetails</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"vitriol95@naver.com"</span><span class="o">,</span> <span class="n">setupBefore</span> <span class="o">=</span> <span class="nc">TestExecutionEvent</span><span class="o">.</span><span class="na">TEST_EXECUTION</span><span class="o">)</span>
    <span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"포스트 제거"</span><span class="o">)</span>
    <span class="nd">@Test</span>
    <span class="kt">void</span> <span class="n">포스트_제거</span><span class="o">()</span> <span class="kd">throws</span> <span class="nc">Exception</span> <span class="o">{</span>

        <span class="nc">Long</span> <span class="n">id</span> <span class="o">=</span> <span class="n">vitriol95Post</span><span class="o">();</span>

        <span class="n">mockMvc</span><span class="o">.</span><span class="na">perform</span><span class="o">(</span><span class="n">post</span><span class="o">(</span><span class="s">"/posts/"</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">"/delete"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">with</span><span class="o">(</span><span class="n">csrf</span><span class="o">()))</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">status</span><span class="o">().</span><span class="na">is3xxRedirection</span><span class="o">())</span>
                <span class="o">.</span><span class="na">andExpect</span><span class="o">(</span><span class="n">redirectedUrl</span><span class="o">(</span><span class="s">"/"</span><span class="o">));</span>

        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">findPostWithAccountById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">assertThat</span><span class="o">(</span><span class="n">post</span><span class="o">).</span><span class="na">isNull</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Long</span> <span class="nf">vitriol95Post</span><span class="o">()</span> <span class="o">{</span>

        <span class="nc">Account</span> <span class="n">vitriol</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="s">"vitriol95@naver.com"</span><span class="o">);</span>
        <span class="k">return</span> <span class="nf">new_post</span><span class="o">(</span><span class="kc">true</span><span class="o">,</span> <span class="n">vitriol</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="nc">Long</span> <span class="nf">new_post</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">open</span><span class="o">,</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Post</span><span class="o">();</span>
        <span class="n">post</span><span class="o">.</span><span class="na">setWriter</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
        <span class="n">post</span><span class="o">.</span><span class="na">setDescription</span><span class="o">(</span><span class="s">"description"</span><span class="o">);</span>
        <span class="n">post</span><span class="o">.</span><span class="na">setIntroduction</span><span class="o">(</span><span class="s">"introduction"</span><span class="o">);</span>
        <span class="n">post</span><span class="o">.</span><span class="na">setOpen</span><span class="o">(</span><span class="n">open</span><span class="o">);</span>
        <span class="n">post</span><span class="o">.</span><span class="na">setTitle</span><span class="o">(</span><span class="s">"title"</span><span class="o">);</span>
        <span class="nc">Post</span> <span class="n">newPost</span> <span class="o">=</span> <span class="n">postService</span><span class="o">.</span><span class="na">createNewPost</span><span class="o">(</span><span class="n">post</span><span class="o">,</span> <span class="n">account</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">newPost</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>역시 @WithUserDetails를 이용하여 진행해야한다. 수정과 삭제버튼의 경우는 글쓴이가 아닌 사람들에게는 보이지 않아야한다.</p></blockquote><p>102번째 라인과 121번째 라인에는 실제 response body로 들어온 html파일의 컨텐츠를 검사하고 있다. 이부분을 좀 더 효율적으로 바꾸려면 html내의 요소들의 Xpath를 이용하면 더 효율적일 수 있다.</p><hr /><h1 id="reply-객체-만들기">Reply 객체 만들기</h1><p>Reply 엔티티의 경우 필요한 프로퍼티는 다음과 같다.</p><ol><li>작성자가 누구인지 –&gt; account<li>어떤 post에 달려있는지 –&gt; post<li>본문 내용</ol><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"reply"</span><span class="o">)</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reply</span> <span class="kd">extends</span> <span class="nc">LocalDateTimeEntity</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Post</span> <span class="n">post</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

<span class="o">}</span>
</pre></table></code></div></div><p>이들의 확장성을 생각하여 Post 엔티티와 Account 엔티티에도 양방향 매핑을 진행해 주었다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre><td class="rouge-code"><pre><span class="c1">// Account.class 수정</span>
<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account"</span><span class="o">)</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@EqualsAndHashCode</span><span class="o">(</span><span class="n">of</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">,</span> <span class="n">callSuper</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="kd">extends</span> <span class="nc">LocalDateTimeEntity</span> <span class="o">{</span>

    <span class="cm">/**
    이전 코드들
    */</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"account"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Reply</span><span class="o">&gt;</span> <span class="n">replies</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

<span class="o">}</span>


<span class="c1">// Post.class 수정</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"post"</span><span class="o">)</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="kd">extends</span> <span class="nc">LocalDateTimeEntity</span> <span class="o">{</span>

    <span class="cm">/**
    이전 코드들
    */</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"post"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Reply</span><span class="o">&gt;</span> <span class="n">replies</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이러한 엔티티 객체가 들어옴으로 인해, PostController에서 보여주던 핸들러와 뷰도 변화가 생길 것이다. 다음시간에는 앞서 말한 변화적용과 함께 Reply의 등록 및 삭제기능을 구현해 보자.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>Spring</a>, <a href='/categories/spring-project/'>spring_project</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/spring-mvc/" class="post-tag no-text-decoration" >spring mvc</a> <a href="/tags/springboot/" class="post-tag no-text-decoration" >springboot</a> <a href="/tags/springframework/" class="post-tag no-text-decoration" >springframework</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=스프링 mvc 프로젝트 + AWS EC2에 빌드까지(4) - Vitriol&url=https://vitriol95.github.io/posts/mvcproject4/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=스프링 mvc 프로젝트 + AWS EC2에 빌드까지(4) - Vitriol&u=https://vitriol95.github.io/posts/mvcproject4/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=스프링 mvc 프로젝트 + AWS EC2에 빌드까지(4) - Vitriol&url=https://vitriol95.github.io/posts/mvcproject4/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/batchbase1/">스프링 배치 - 1 스프링 배치란?</a><li><a href="/posts/batchbase2/">스프링 배치 - 2 DB 스키마에 대한 이해</a><li><a href="/posts/batchbase3/">스프링 배치 - 3 도메인 뜯어보기(JOB)</a><li><a href="/posts/batchbase4/">스프링 배치 - 4 도메인 뜯어보기(STEP)</a><li><a href="/posts/batchbase5/">스프링 배치 - 5 청크 지향 처리</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">백준</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mvcproject1/"><div class="card-body"> <span class="timeago small" > Jun 1, 2021 <i class="unloaded">2021-06-01T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(1)</h3><div class="text-muted small"><p> 프로젝트 목표 스프링 부트를 이용하여 간단한 게시판 페이지를 만들어 보려한다. 그리고 이를 AWS의 EC2를 이용하여 직접 라이브 서버에 띄워보는 것을 목표로 한다. 초기 설정 JDK 버전은 11에 해당하며, 스프링 부트의 버전은 2.4.7을 사용했다. 불러온 라이브러리들은 lombok, devtool, web, dataJpa 마지막으로 템플...</p></div></div></a></div><div class="card"> <a href="/posts/mvcporject2/"><div class="card-body"> <span class="timeago small" > Jun 2, 2021 <i class="unloaded">2021-06-02T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(2)</h3><div class="text-muted small"><p> 이전 글 이전글 에서는 Account 클래스를 만들고 이에 Spring Security를 적용하여 로그인과 회원가입을 진행해보았다. 이번시간에는 Account와 관련된 기능들을 좀 더 다듬고, MockMvc를 이용해 테스트를 진행해 보려한다. Account 다듬기 회원가입 - 추가 1 지난 시간, 회원가입에 추가하지 않은 로직이 존재한다. 바로...</p></div></div></a></div><div class="card"> <a href="/posts/mvcproject3/"><div class="card-body"> <span class="timeago small" > Jun 3, 2021 <i class="unloaded">2021-06-03T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3)</h3><div class="text-muted small"><p> 이전 글 이전글 에서는 Account와 관련된 기능들을 좀 더 다듬고, MockMvc를 이용해 테스트를 진행해 보았다. 이번 시간에는 Account의 정보 수정을 구현하고 Post라는 엔티티를 정의해보려한다. Account 정보 수정 정보변경에 대한 기능은 프론트뷰에선 다음과 같이 위치해 있으며 클릭시 URI는 “/settings”에 해당한다...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/boj14499/" class="btn btn-outline-primary" prompt="Older"><p>백준 14499 주사위 굴리기 with Python</p></a> <a href="/posts/boj2042/" class="btn btn-outline-primary" prompt="Newer"><p>백준 2042 구간 합 구하기 with Python</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">vitriol</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">백준</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://vitriol95.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
