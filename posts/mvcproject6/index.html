<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="스프링 mvc 프로젝트 + AWS EC2에 빌드까지(6)" /><meta property="og:locale" content="ko" /><meta name="description" content="이전 글" /><meta property="og:description" content="이전 글" /><link rel="canonical" href="https://vitriol95.github.io/posts/mvcproject6/" /><meta property="og:url" content="https://vitriol95.github.io/posts/mvcproject6/" /><meta property="og:site_name" content="Vitriol" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-06T11:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="스프링 mvc 프로젝트 + AWS EC2에 빌드까지(6)" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="QsbP4NOwVkaE8CnHpYOl-qNGhxB9m1RbsrBEefA92ao" /> <script type="application/ld+json"> {"headline":"스프링 mvc 프로젝트 + AWS EC2에 빌드까지(6)","dateModified":"2021-06-06T11:00:00+09:00","datePublished":"2021-06-06T11:00:00+09:00","description":"이전 글","url":"https://vitriol95.github.io/posts/mvcproject6/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://vitriol95.github.io/posts/mvcproject6/"},"@context":"https://schema.org"}</script><title>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(6) | Vitriol</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Vitriol"><meta name="application-name" content="Vitriol"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WSY4XYN711"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WSY4XYN711'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Vitriol</a></div><div class="site-subtitle font-italic">기억을 적는 시간</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/vitriol95" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['vitriol951','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(6)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(6)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> vitriol </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Jun 6, 2021, 11:00 AM +0900" prep="on" > Jun 6, 2021 <i class="unloaded">2021-06-06T11:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3145 words">17 min</span></div></div><div class="post-content"><h1 id="이전-글">이전 글</h1><p><a href="https://vitriol95.github.io/posts/mvcproject5/">이전글</a> 에서는 Reply객체가 들어옴으로써 발생하는 컨트롤러와 뷰단의 변화를 적용하고 Reply의 등록 및 삭제기능을 구현해 보았다. 이번시간에는 게시글에 대한 검색기능과, 유저 목록을 보여주는 기능을 구현해보자.</p><hr /><h1 id="게시글-검색하기">게시글 검색하기</h1><p>게시글 검색의 경우 메인 nav-bar의 오른쪽에 구현이 되어 있다. 기능은 다음과 같다.</p><ul><li>검색창에 키워드를 입력하고 검색하면 본 키워드가 제목에 포함된 게시글만을 보여주게 된다.<li>이때 카드형식으로 게시글이 노출되며 제목, 간단한 설명(introduction), 작성자, 댓글 수, 등록일이 보이게 된다.<li>페이징을 적용한다. 총 12개가 한 화면에 보이게끔 설정해 두었다.<li>보여지는 게시글은 정렬방식을 달리할 수 있다. 최신순으로 부터 볼 수 있으며, 댓글이 많은 순으로 볼 수도 있다.</ul><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/21.JPG" /></p><p>가장 먼저, main-nav의 게시글 검색에 해당하는 인라인 폼을 다음과 같이 짜두었다.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-inline my-2 my-lg-0"</span> <span class="na">th:action=</span><span class="s">"@{/search/post}"</span> <span class="na">method=</span><span class="s">"get"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;input</span> <span class="na">class=</span><span class="s">"form-control mr-sm-2"</span> <span class="na">name=</span><span class="s">"keyword"</span> <span class="na">type=</span><span class="s">"search"</span> <span class="na">placeholder=</span><span class="s">"게시글 검색"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-outline-success my-2 my-sm-0"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>Search<span class="nt">&lt;/button&gt;</span>
<span class="nt">&lt;/form&gt;</span>
</pre></table></code></div></div><p>get 방식을 통해 /search/post로 접근하게 되며, 이때 input 태그에 걸려있는 <code class="language-plaintext highlighter-rouge">name="keyword"</code>이므로 쿼리스트링으로 ?keyword= 가 붙게될 것이다. 즉 URL은 다음과 같다. <code class="language-plaintext highlighter-rouge">/search/post?keyword= </code></p><p><br /> 이에 대한 컨트롤러를 구현해보면 다음과 같다. (MainController.java 에 구현하였다.)</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">// MainController.java</span>
<span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/search/post"</span><span class="o">)</span>
<span class="kd">public</span> <span class="nc">String</span> <span class="nf">searchPost</span><span class="o">(</span><span class="nd">@PageableDefault</span><span class="o">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">12</span><span class="o">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="s">"createdDate"</span><span class="o">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">)</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nc">String</span> <span class="n">keyword</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="n">postPage</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">findByKeyword</span><span class="o">(</span><span class="n">keyword</span><span class="o">,</span> <span class="n">pageable</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"postPage"</span><span class="o">,</span> <span class="n">postPage</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"keyword"</span><span class="o">,</span> <span class="n">keyword</span><span class="o">);</span>
    <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"sortProperty"</span><span class="o">,</span> <span class="n">pageable</span><span class="o">.</span><span class="na">getSort</span><span class="o">().</span><span class="na">toString</span><span class="o">().</span><span class="na">contains</span><span class="o">(</span><span class="s">"createdDate"</span><span class="o">)</span> <span class="o">?</span> <span class="s">"createdDate"</span> <span class="o">:</span> <span class="s">"replyCount"</span><span class="o">);</span>

    <span class="k">return</span> <span class="s">"search"</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><p>파라미터를 살펴보자. 페이징을 적용할 것이기 때문에 @PagebleDefault 어노테이션을 이용하여 Pageable 객체를 전달하였다. 기본 정렬은 등록 날짜 최신순(DESC)으로 하였다. 그리고 @ModelAttribute에 해당하는 <code class="language-plaintext highlighter-rouge">String Keyword</code>가 들어와있다.</p><p><br /> 뷰 단으로, 쿼리를 진행한 Page 객체인 postPage를 넘겨주어야 하며, 검색했던 keyword와 정렬방식에 해당하는 sortProperty를 넘겨주었다.</p><p><br /> 여기서 가장 핵심은 <code class="language-plaintext highlighter-rouge">postRepository.findByKeyword(keyword, pageable)</code> 이다. 키워드와 pageable을 파라미터로 받아 실제 그에 해당하는 post를 가져오는 메서드에 해당한다. 필자는 이를 QueryDsl을 이용하여 간소화 시켜보고자 한다. <br /></p><hr /><h2 id="gradle에-querydsl-의존성-추가하기">gradle에 QueryDsl 의존성 추가하기</h2><p>가장 먼저, build.gradle에 QueryDsl의 의존성을 추가해주어야 한다. 필자는 gradle7.0을 사용하여 프로그램을 빌드중이므로 다음과 같이 추가해 주었다.</p><div class="language-groovy highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
</pre><td class="rouge-code"><pre><span class="c1">// build.gradle</span>

<span class="n">dependencies</span> <span class="o">{</span>
    <span class="cm">/**
    이전코드
    */</span>

    <span class="cm">/** query DSL*/</span>
    <span class="n">compile</span> <span class="s2">"com.querydsl:querydsl-jpa"</span>
    <span class="n">compile</span> <span class="s2">"com.querydsl:querydsl-core"</span>
    <span class="n">annotationProcessor</span> <span class="s2">"com.querydsl:querydsl-apt:${dependencyManagement.importedProperties['querydsl.version']}:jpa"</span> <span class="c1">// querydsl JPAAnnotationProcessor 사용 지정</span>
    <span class="n">annotationProcessor</span> <span class="s2">"jakarta.persistence:jakarta.persistence-api:2.2.3"</span>
    <span class="n">annotationProcessor</span> <span class="s2">"jakarta.annotation:jakarta.annotation-api:1.3.5"</span>
<span class="o">}</span>

<span class="c1">// querydsl 의 Q파일의 위치 및 task 적용</span>
<span class="kt">def</span> <span class="n">generated</span><span class="o">=</span><span class="s1">'src/main/generated'</span>
<span class="n">sourceSets</span> <span class="o">{</span>
    <span class="n">main</span><span class="o">.</span><span class="na">java</span><span class="o">.</span><span class="na">srcDirs</span> <span class="o">+=</span> <span class="o">[</span> <span class="n">generated</span> <span class="o">]</span>
<span class="o">}</span>

<span class="n">tasks</span><span class="o">.</span><span class="na">withType</span><span class="o">(</span><span class="n">JavaCompile</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">options</span><span class="o">.</span><span class="na">annotationProcessorGeneratedSourcesDirectory</span> <span class="o">=</span> <span class="n">file</span><span class="o">(</span><span class="n">generated</span><span class="o">)</span>
<span class="o">}</span>

<span class="n">clean</span><span class="o">.</span><span class="na">doLast</span> <span class="o">{</span>
    <span class="n">file</span><span class="o">(</span><span class="n">generated</span><span class="o">).</span><span class="na">deleteDir</span><span class="o">()</span>
<span class="o">}</span>

</pre></table></code></div></div><p>최신 gradle 버전에서 권장하는 방식인 annotationProcessor를 이용하여 dependencies를 추가해주었다.</p><p><br /> 이후 17 라인부터에 대한 간략한 설명은 다음과 같다.</p><ol><li>가장 먼저, Q파일들이 생성될 위치를 generated에 정의해준다.<li>이후, main.java.srcDirs 에 앞서 정의한 generated를 추가해준다.<blockquote><p>gradle에서 기본 제공되는 main.java.srcDirs의 경우는 ‘src/main/java’에만 해당하지만, 이 sourceSets에 ‘src/main/generated’를 포함시켜주는 것이다. 이렇게 되면 ‘src/main/generated’역시 gradle build의 대상이 된다.</p></blockquote><li>22번째 라인의 경우 gradle이 build될때 수행하는 JavaCompile이라는 태스크에 옵션을 추가해주는 것에 해당한다.<blockquote><p>우리는 annotaionProcessor로 queryDsl을 등록해 두었으므로 JavaCompile이라는 태스크가 진행될 때 generated 파일을 생성하게 된다.</p></blockquote><li>마지막으로 gradle의 clean 태스크에 마지막 명령을 추가해준다.<blockquote><p>gradle clean을 진행할 때, 이 generated 디렉토리를 함께 지워버리는 것이다. 만약 Q파일들만 따로 지우고 싶다면 새로운 task를 정의하는 방법도 있다.</p></blockquote></ol><p><br /> 이로써 gradle 설정은 모두 마무리 되었다. 다시 <code class="language-plaintext highlighter-rouge">postRepository.findByKeyword</code> 로 돌아가자.</p><hr /><h2 id="검색-쿼리-구현하기findbykeyword">검색 쿼리 구현하기(findByKeyword)</h2><p>queryDsl을 사용하기 위해 <code class="language-plaintext highlighter-rouge">PostRepositoryEx</code>라는 새로운 repository를 생성하고 이를 JPA Repository인 <code class="language-plaintext highlighter-rouge">PostRepository</code>가 상속하게 한다. 그리고 이 <code class="language-plaintext highlighter-rouge">PostRepositoryEx</code>는 findByKeyword라는 메서드를 가지게 된다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="c1">// PostRepositoryEx.java</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PostRepositoryEx</span> <span class="o">{</span>

    <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findByKeyword</span><span class="o">(</span><span class="nc">String</span> <span class="n">keyword</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">);</span>

<span class="o">}</span>

<span class="c1">// PostRepository.java</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PostRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;,</span> <span class="nc">PostRepositoryEx</span> <span class="o">{</span>

    <span class="cm">/**
    이전 코드들
    */</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이후 PostRepositoryEx에 구현체에 해당하는 PostRepositoryExImpl이라는 클래스를 생성하여 이 메서드를 구현해야한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostRepositoryExImpl</span> <span class="kd">extends</span> <span class="nc">QuerydslRepositorySupport</span> <span class="kd">implements</span> <span class="nc">PostRepositoryEx</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="nf">PostRepositoryExImpl</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="nf">findByKeyword</span><span class="o">(</span><span class="nc">String</span> <span class="n">keyword</span><span class="o">,</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">QPost</span> <span class="n">post</span> <span class="o">=</span> <span class="nc">QPost</span><span class="o">.</span><span class="na">post</span><span class="o">;</span>
        <span class="nc">JPQLQuery</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="n">query</span> <span class="o">=</span> <span class="n">from</span><span class="o">(</span><span class="n">post</span><span class="o">).</span><span class="na">where</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">open</span><span class="o">.</span><span class="na">isTrue</span><span class="o">()</span>
                <span class="o">.</span><span class="na">and</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">title</span><span class="o">.</span><span class="na">containsIgnoreCase</span><span class="o">(</span><span class="n">keyword</span><span class="o">)))</span>
                <span class="o">.</span><span class="na">leftJoin</span><span class="o">(</span><span class="n">post</span><span class="o">.</span><span class="na">account</span><span class="o">,</span> <span class="nc">QAccount</span><span class="o">.</span><span class="na">account</span><span class="o">).</span><span class="na">fetchJoin</span><span class="o">();</span>

        <span class="nc">JPQLQuery</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="n">pageableQuery</span> <span class="o">=</span> <span class="n">getQuerydsl</span><span class="o">().</span><span class="na">applyPagination</span><span class="o">(</span><span class="n">pageable</span><span class="o">,</span> <span class="n">query</span><span class="o">);</span>
        <span class="nc">QueryResults</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="n">fetchResults</span> <span class="o">=</span> <span class="n">pageableQuery</span><span class="o">.</span><span class="na">fetchResults</span><span class="o">();</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nc">PageImpl</span><span class="o">&lt;&gt;(</span><span class="n">fetchResults</span><span class="o">.</span><span class="na">getResults</span><span class="o">(),</span> <span class="n">pageable</span><span class="o">,</span> <span class="n">fetchResults</span><span class="o">.</span><span class="na">getTotal</span><span class="o">());</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>다음과 같이 QueryDsl을 이용하여 findByKeyword를 구현하였다. 게시글이 열려있으며(open) 대소문자 구분없이 타이틀을 포함하고 있다면 이 값을 가져오게 된다.<br /> 글쓴이에 해당하는 post.account들은 프로필 이미지나 닉네임을 보여주어야 하기에 fetchJoin으로 모두 managed 상태로 만들어주었다.</p><blockquote><p>아.. queryDsl은 정말 너무 편하다.</p></blockquote><p><br /> 그리고 마지막으로 paging을 적용한 결과와, pageable, 전체 카운트를 PageImpl(구현체)에 담아 전달한다.</p><p><br /> 🤔 하지만 다음과 같은 의구심이 발생할 수 있다. <strong>‘게시글 목록을 보여줄 때, 댓글의 개수도 함께 보여주어야 하는데, 이러면 post.reply도 함께 조인해서 가져와야 하는 것이 아닌가?’</strong></p><p><br /> 이에 대한 비용을 조금이나마 줄여보기 위해서 필자는 Post엔티티에 replyCount라는 프로퍼티를 정의해 두었다. 댓글이 등록될 경우 카운트가 1증가하고, 삭제될 경우 1내려가게 된다. 하지만 이 방식도 장단점이 존재한다.</p><ul><li><strong>기존 댓글이 등록될 경우</strong>) Reply 엔티티에 대한 Insert 쿼리가 한방이 나가고 종료가 된다. =&gt; 총 1개의 쿼리<li><strong>위의 방식으로 댓글 등록을 진행할 경우</strong>) InsertQuery와 함께 post에 대한 update 쿼리가 함께 나가게 된다. =&gt; 총 2개의 쿼리</ul><hr /><h2 id="검색-뷰-구현">검색 뷰 구현</h2><p>마지막으로 검색 결과를 보여주는 뷰는 다음과 같이 구현하였다.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- search.html --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span> <span class="na">xmlns:sec=</span><span class="s">"http://thymeleaf.org/extras/spring-security"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head</span> <span class="na">th:replace=</span><span class="s">"fragments.html :: head"</span><span class="nt">&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
<span class="nt">&lt;nav</span> <span class="na">th:replace=</span><span class="s">"fragments.html :: main-nav"</span><span class="nt">&gt;&lt;/nav&gt;</span>

<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"py-5 text-center"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead"</span> <span class="na">th:if=</span><span class="s">"${postPage.getTotalElements() == 0}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;strong</span> <span class="na">th:text=</span><span class="s">"${keyword}"</span> <span class="na">id=</span><span class="s">"keyword"</span> <span class="na">class=</span><span class="s">"context"</span><span class="nt">&gt;&lt;/strong&gt;</span>에 해당하는 게시글이 없습니다.
        <span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead"</span> <span class="na">th:if=</span><span class="s">"${postPage.getTotalElements() &gt; 0}"</span><span class="nt">&gt;</span>
            '<span class="nt">&lt;strong</span> <span class="na">th:text=</span><span class="s">"${keyword}"</span> <span class="na">id=</span><span class="s">"keyword"</span> <span class="na">class=</span><span class="s">"context"</span><span class="nt">&gt;&lt;/strong&gt;</span>'에 해당하는 게시글을
            <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"${postPage.getTotalElements()}"</span><span class="nt">&gt;&lt;/span&gt;</span>개
            찾았습니다.
        <span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dropdown"</span> <span class="na">th:if=</span><span class="s">"${postPage.getTotalElements() &gt; 0}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-light dropdown-toggle"</span> <span class="na">type=</span><span class="s">"button"</span> <span class="na">id=</span><span class="s">"dropdownMenuButton"</span> <span class="na">data-toggle=</span><span class="s">"dropdown"</span> <span class="na">aria-haspopup=</span><span class="s">"true"</span> <span class="na">aria-expanded=</span><span class="s">"false"</span><span class="nt">&gt;</span>
                검색 결과 정렬 방식
            <span class="nt">&lt;/button&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"dropdown-menu"</span> <span class="na">aria-labelledby=</span><span class="s">"dropdownMenuButton"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-item"</span> <span class="na">th:classappend=</span><span class="s">"${#strings.equals(sortProperty, 'createdDate')}? active"</span>
                   <span class="na">th:href=</span><span class="s">"@{'/search/post?sort=createdDate,desc&amp;keyword=' + ${keyword}}"</span><span class="nt">&gt;</span>
                    게시글 최신순
                <span class="nt">&lt;/a&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"dropdown-item"</span> <span class="na">th:classappend=</span><span class="s">"${#strings.equals(sortProperty, 'replyCount')}? active"</span>
                   <span class="na">th:href=</span><span class="s">"@{'/search/post?sort=replyCount,desc&amp;keyword=' + ${keyword}}"</span><span class="nt">&gt;</span>
                    댓글 수
                <span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-10"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-md-4"</span> <span class="na">th:each=</span><span class="s">"post: ${postPage.getContent()}"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card mb-4 shadow-sm"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"/img/ffff0.JPG"</span> <span class="na">class=</span><span class="s">"context card-img-top"</span> <span class="na">th:alt=</span><span class="s">"${post.title}"</span> <span class="nt">&gt;</span>
                        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"card-body"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{'/posts/' + ${post.id}}"</span> <span class="na">class=</span><span class="s">"text-decoration-none"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;h5</span> <span class="na">class=</span><span class="s">"card-title context"</span> <span class="na">th:text=</span><span class="s">"${post.title} + '('+${post.replyCount}+')'"</span><span class="nt">&gt;&lt;/h5&gt;</span>
                            <span class="nt">&lt;/a&gt;</span>
                            <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"card-text"</span> <span class="na">th:text=</span><span class="s">"${post.introduction}"</span><span class="nt">&gt;</span>Introduction<span class="nt">&lt;/p&gt;</span>

                            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-flex justify-content-between align-items-center"</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;span&gt;</span>
                                    <span class="nt">&lt;svg</span> <span class="na">th:if=</span><span class="s">"${#strings.isEmpty(post.account?.profileImage)}"</span> <span class="na">data-jdenticon-value=</span><span class="s">"user111"</span> <span class="na">th:data-jdenticon-value=</span><span class="s">"${post.account.email}"</span>
                                         <span class="na">width=</span><span class="s">"20"</span> <span class="na">height=</span><span class="s">"20"</span> <span class="na">class=</span><span class="s">"rounded boarder bg-light"</span><span class="nt">&gt;&lt;/svg&gt;</span>
                                    <span class="nt">&lt;img</span> <span class="na">th:if=</span><span class="s">"${!#strings.isEmpty(post.account?.profileImage)}"</span> <span class="na">th:src=</span><span class="s">"${post.account.profileImage}"</span>
                                         <span class="na">width=</span><span class="s">"20"</span> <span class="na">height=</span><span class="s">"20"</span> <span class="na">class=</span><span class="s">"rounded boarder bg-light"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"lh-100 h6 mb-0"</span> <span class="na">th:text=</span><span class="s">"${post.account.nickname}"</span><span class="nt">&gt;&lt;/span&gt;</span>
                                <span class="nt">&lt;/span&gt;</span>
                                <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"text-muted date"</span> <span class="na">th:text=</span><span class="s">"${#temporals.format(post.modifiedDate,'yyyy-MM-dd HH:mm')}"</span><span class="nt">&gt;&lt;/small&gt;</span>
                            <span class="nt">&lt;/div&gt;</span>
                        <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-10"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;nav&gt;</span>
                <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"pagination justify-content-center"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span> <span class="na">th:classappend=</span><span class="s">"${!postPage.hasPrevious()}? disabled"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{'/search/post?keyword=' + ${keyword} + '&amp;sort=' + ${sortProperty} + ',desc&amp;page=' + ${postPage.getNumber() - 1}}"</span>
                           <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">tabindex=</span><span class="s">"-1"</span> <span class="na">aria-disabled=</span><span class="s">"true"</span><span class="nt">&gt;</span>
                            Previous
                        <span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span> <span class="na">th:classappend=</span><span class="s">"${i == postPage.getNumber()}? active"</span> <span class="na">th:each=</span><span class="s">"i: ${#numbers.sequence(0, postPage.getTotalPages() - 1)}"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{'/search/post?keyword=' + ${keyword} + '&amp;sort=' + ${sortProperty} + ',desc&amp;page=' + ${i}}"</span>
                           <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">th:text=</span><span class="s">"${i + 1}"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span> <span class="na">th:classappend=</span><span class="s">"${!postPage.hasNext()}? disabled"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{'/search/study?keyword=' + ${keyword} + '&amp;sort=' + ${sortProperty} + ',desc&amp;page=' + ${postPage.getNumber() + 1}}"</span>
                           <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>
                            Next
                        <span class="nt">&lt;/a&gt;</span>
                    <span class="nt">&lt;/li&gt;</span>
                <span class="nt">&lt;/ul&gt;</span>
            <span class="nt">&lt;/nav&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js"</span> <span class="na">integrity=</span><span class="s">"sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww=="</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span> <span class="na">referrerpolicy=</span><span class="s">"no-referrer"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js"</span> <span class="na">integrity=</span><span class="s">"sha512-mhbv5DqBMgrWL+32MmsDOt/OAvqr/cHimk6B8y/bx/xS88MVkYGPiVv2ixKVrkywF2qHplNRUvFsAHUdxZ3Krg=="</span> <span class="na">crossorigin=</span><span class="s">"anonymous"</span> <span class="na">referrerpolicy=</span><span class="s">"no-referrer"</span><span class="nt">&gt;&lt;/script&gt;</span>
<span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"application/javascript"</span><span class="nt">&gt;</span>
    <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
        <span class="kd">var</span> <span class="nx">mark</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="c1">// Read the keyword</span>
            <span class="kd">var</span> <span class="nx">keyword</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#keyword</span><span class="dl">"</span><span class="p">).</span><span class="nx">text</span><span class="p">();</span>

            <span class="c1">// Determine selected options</span>
            <span class="kd">var</span> <span class="nx">options</span> <span class="o">=</span> <span class="p">{</span>
                <span class="dl">"</span><span class="s2">each</span><span class="dl">"</span><span class="p">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">element</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">$</span><span class="p">(</span><span class="nx">element</span><span class="p">).</span><span class="nx">addClass</span><span class="p">(</span><span class="dl">"</span><span class="s2">animate</span><span class="dl">"</span><span class="p">);</span>
                    <span class="p">},</span> <span class="mi">150</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">};</span>

            <span class="c1">// Mark the keyword inside the context</span>
            <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.context</span><span class="dl">"</span><span class="p">).</span><span class="nx">unmark</span><span class="p">({</span>
                <span class="na">done</span><span class="p">:</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
                    <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">.context</span><span class="dl">"</span><span class="p">).</span><span class="nx">mark</span><span class="p">(</span><span class="nx">keyword</span><span class="p">,</span> <span class="nx">options</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">};</span>

        <span class="nx">mark</span><span class="p">();</span>
    <span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><blockquote><p>87~114 라인에 해당하는 js는 mark.js 라는 오픈소스를 사용하였다. 이를 통해 검색한 keyword가 검색 결과에서 하이라이팅이 된다.</p></blockquote><p><br /> 이제 실제로 잘 진행되는지 확인해 보자.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/22.png" /></p><p>페이징 또한 잘 되어 있었고, 최신순으로 정렬되어 있었다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/23.png" /></p><p>검색 조건을 댓글수로 바꾼 결과에 해당한다. 역시 잘 정렬이 되어 있었다.</p><hr /><h1 id="유저-목록-보여주기">유저 목록 보여주기</h1><p>유저 목록의 경우 로그인을 하였을때 내정보 바로 옆에 위치하고 있으며 위 버튼을 클릭할 시 ‘/accounts’페이지를 Get방식으로 이동하게 된다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/24.png" /></p><p>이 페이지에서는 다음과 같이 유저 정보를 보여줄 예정이다.</p><ol><li>총 몇명의 유저가 있는지 알려준다.<li>페이징을 적용한다. 한 페이지당 20건의 유저가 노출된다.<li>유저들은 테이블의 형태로 보여지며 아이콘, 닉네임, 게시글 수, 댓글 수, 가입일자가 나타난다.<li>게시글이 많은 순으로 보여지게 되며 다른 검색 조건은 구현하지 않았다.</ol><p><br /> 이에 대한 컨트롤러는 다음과 같다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// AccountController.java</span>
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/accounts"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">allAccountView</span><span class="o">(</span><span class="nd">@PageableDefault</span><span class="o">(</span><span class="n">size</span> <span class="o">=</span> <span class="mi">20</span><span class="o">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="s">"postCount"</span><span class="o">,</span> <span class="n">direction</span> <span class="o">=</span> <span class="nc">Sort</span><span class="o">.</span><span class="na">Direction</span><span class="o">.</span><span class="na">DESC</span><span class="o">)</span> <span class="nc">Pageable</span> <span class="n">pageable</span><span class="o">,</span> <span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Page</span><span class="o">&lt;</span><span class="nc">Account</span><span class="o">&gt;</span> <span class="n">accountPage</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findAll</span><span class="o">(</span><span class="n">pageable</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"account"</span><span class="o">,</span> <span class="n">account</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"accountPage"</span><span class="o">,</span> <span class="n">accountPage</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"account/all"</span><span class="o">;</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>Spring Data Jpa가 지원하는 findAll(Pageable) 메서드를 이용하였고 이를 바탕으로 accountPage를 가져왔다. 이를 모델에 넣어 뷰에 전달하기만 하면 된다. 뷰는 다음과 같이 구현하였다.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span>
      <span class="na">xmlns:sec=</span><span class="s">"http://thymeleaf.org/extras/spring-security"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head</span> <span class="na">th:replace=</span><span class="s">"fragments.html :: head"</span><span class="nt">&gt;&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;nav</span> <span class="na">th:replace=</span><span class="s">"fragments.html :: main-nav"</span><span class="nt">&gt;&lt;/nav&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"py-5 text-center"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;p</span> <span class="na">class=</span><span class="s">"lead"</span><span class="nt">&gt;</span>Vitriol's Account<span class="nt">&lt;/p&gt;</span>
        <span class="nt">&lt;h2&gt;</span>
            전체 유저보기 - <span class="nt">&lt;span&gt;</span>총 <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"${accountPage.getTotalElements()}"</span><span class="nt">&gt;&lt;/span&gt;</span>명의 유저가 활동중입니다.<span class="nt">&lt;/span&gt;</span>
        <span class="nt">&lt;/h2&gt;</span>
        <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"text-info"</span><span class="nt">&gt;</span>현재는 검색으로 유저를 찾으실 수 없습니다.<span class="nt">&lt;/small&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;thead&gt;</span>
            <span class="nt">&lt;tr&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>Icon<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>닉네임<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>게시글 수<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>댓글 수<span class="nt">&lt;/th&gt;</span>
                <span class="nt">&lt;th</span> <span class="na">scope=</span><span class="s">"col"</span><span class="nt">&gt;</span>가입 날짜<span class="nt">&lt;/th&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/thead&gt;</span>
            <span class="nt">&lt;tbody&gt;</span>
            <span class="nt">&lt;tr</span> <span class="na">th:each=</span><span class="s">"all : ${accountPage.getContent()}"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;td&gt;&lt;svg</span> <span class="na">th:if=</span><span class="s">"${#strings.isEmpty(all?.profileImage)}"</span> <span class="na">th:data-jdenticon-value=</span><span class="s">"${all.email}"</span>
                         <span class="na">width=</span><span class="s">"32"</span> <span class="na">height=</span><span class="s">"32"</span> <span class="na">class=</span><span class="s">"rounded boarder bg-light"</span><span class="nt">&gt;&lt;/svg&gt;</span>
                    <span class="nt">&lt;img</span> <span class="na">th:if=</span><span class="s">"${!#strings.isEmpty(all?.profileImage)}"</span> <span class="na">th:src=</span><span class="s">"${all.profileImage}"</span>
                         <span class="na">width=</span><span class="s">"32"</span> <span class="na">height=</span><span class="s">"32"</span> <span class="na">class=</span><span class="s">"rounded boarder bg-light"</span><span class="nt">&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${all.nickname}"</span><span class="nt">&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${all.postCount}"</span><span class="nt">&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${all.replyCount}"</span><span class="nt">&gt;&lt;/td&gt;</span>
                <span class="nt">&lt;td</span> <span class="na">th:text=</span><span class="s">"${#temporals.format(all.createdDate,'yyyy-MM-dd HH:mm')}"</span><span class="nt">&gt;&lt;/td&gt;</span>
            <span class="nt">&lt;/tr&gt;</span>
            <span class="nt">&lt;/tbody&gt;</span>
        <span class="nt">&lt;/table&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"row justify-content-center"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"col-sm-10"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;nav&gt;</span>
                    <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"pagination justify-content-center"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span> <span class="na">th:classappend=</span><span class="s">"${!accountPage.hasPrevious()}? disabled"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{'/accounts&amp;page=' + ${accountPage.getNumber() - 1}}"</span>
                               <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">tabindex=</span><span class="s">"-1"</span> <span class="na">aria-disabled=</span><span class="s">"true"</span><span class="nt">&gt;</span>
                                Previous
                            <span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span> <span class="na">th:classappend=</span><span class="s">"${i == accountPage.getNumber()}? active"</span> <span class="na">th:each=</span><span class="s">"i: ${#numbers.sequence(0, accountPage.getTotalPages() - 1)}"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{'/accounts&amp;page=' + ${i}}"</span> <span class="na">class=</span><span class="s">"page-link"</span> <span class="na">href=</span><span class="s">"#"</span> <span class="na">th:text=</span><span class="s">"${i + 1}"</span><span class="nt">&gt;</span>1<span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                        <span class="nt">&lt;li</span> <span class="na">class=</span><span class="s">"page-item"</span> <span class="na">th:classappend=</span><span class="s">"${!accountPage.hasNext()}? disabled"</span><span class="nt">&gt;</span>
                            <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{'/accounts&amp;page=' + ${accountPage.getNumber() + 1}}"</span> <span class="na">class=</span><span class="s">"page-link"</span><span class="nt">&gt;</span>
                                Next
                            <span class="nt">&lt;/a&gt;</span>
                        <span class="nt">&lt;/li&gt;</span>
                    <span class="nt">&lt;/ul&gt;</span>
                <span class="nt">&lt;/nav&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>실제 페이지에 접속하여 테스트해보자.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/25.png" /></p><p>페이징이 잘 적용되어 있었으며, 게시글수로 정렬이 되어있었다.</p><p><br /> 다음 시간에는 구현한 기능들에 대해 단위 테스트를 진행해보고, 이 과정에서 나타나는 버그들을 수정해보는 시간을 가질 예정이다. 또한 DB를 h2가 아닌 MySQL로 옮기는 작업도 필요하다. 배포이전의 마지막 시간이 될 예정이다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>Spring</a>, <a href='/categories/spring-project/'>spring_project</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/spring-mvc/" class="post-tag no-text-decoration" >spring mvc</a> <a href="/tags/springboot/" class="post-tag no-text-decoration" >springboot</a> <a href="/tags/springframework/" class="post-tag no-text-decoration" >springframework</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=스프링 mvc 프로젝트 + AWS EC2에 빌드까지(6) - Vitriol&url=https://vitriol95.github.io/posts/mvcproject6/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=스프링 mvc 프로젝트 + AWS EC2에 빌드까지(6) - Vitriol&u=https://vitriol95.github.io/posts/mvcproject6/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=스프링 mvc 프로젝트 + AWS EC2에 빌드까지(6) - Vitriol&url=https://vitriol95.github.io/posts/mvcproject6/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/batchbase1/">스프링 배치 - 1 스프링 배치란?</a><li><a href="/posts/batchbase2/">스프링 배치 - 2 DB 스키마에 대한 이해</a><li><a href="/posts/batchbase3/">스프링 배치 - 3 도메인 뜯어보기(JOB)</a><li><a href="/posts/batchbase4/">스프링 배치 - 4 도메인 뜯어보기(STEP)</a><li><a href="/posts/batchbase5/">스프링 배치 - 5 청크 지향 처리</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">백준</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mvcproject1/"><div class="card-body"> <span class="timeago small" > Jun 1, 2021 <i class="unloaded">2021-06-01T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(1)</h3><div class="text-muted small"><p> 프로젝트 목표 스프링 부트를 이용하여 간단한 게시판 페이지를 만들어 보려한다. 그리고 이를 AWS의 EC2를 이용하여 직접 라이브 서버에 띄워보는 것을 목표로 한다. 초기 설정 JDK 버전은 11에 해당하며, 스프링 부트의 버전은 2.4.7을 사용했다. 불러온 라이브러리들은 lombok, devtool, web, dataJpa 마지막으로 템플...</p></div></div></a></div><div class="card"> <a href="/posts/mvcporject2/"><div class="card-body"> <span class="timeago small" > Jun 2, 2021 <i class="unloaded">2021-06-02T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(2)</h3><div class="text-muted small"><p> 이전 글 이전글 에서는 Account 클래스를 만들고 이에 Spring Security를 적용하여 로그인과 회원가입을 진행해보았다. 이번시간에는 Account와 관련된 기능들을 좀 더 다듬고, MockMvc를 이용해 테스트를 진행해 보려한다. Account 다듬기 회원가입 - 추가 1 지난 시간, 회원가입에 추가하지 않은 로직이 존재한다. 바로...</p></div></div></a></div><div class="card"> <a href="/posts/mvcproject3/"><div class="card-body"> <span class="timeago small" > Jun 3, 2021 <i class="unloaded">2021-06-03T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3)</h3><div class="text-muted small"><p> 이전 글 이전글 에서는 Account와 관련된 기능들을 좀 더 다듬고, MockMvc를 이용해 테스트를 진행해 보았다. 이번 시간에는 Account의 정보 수정을 구현하고 Post라는 엔티티를 정의해보려한다. Account 정보 수정 정보변경에 대한 기능은 프론트뷰에선 다음과 같이 위치해 있으며 클릭시 URI는 “/settings”에 해당한다...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/boj15686/" class="btn btn-outline-primary" prompt="Older"><p>백준 15686 치킨 배달 with Python</p></a> <a href="/posts/boj1086/" class="btn btn-outline-primary" prompt="Newer"><p>백준 1086 박성원 with Python(pypy3)</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">vitriol</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">백준</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://vitriol95.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
