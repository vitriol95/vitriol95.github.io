<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="자바(JVM)의 구동 원리 및 구조 - 1" /><meta property="og:locale" content="ko" /><meta name="description" content="JAVA의 전체적인 틀 동작원리를 알기 전에, 먼저 자바의 파일들이 어떻게 구성되어있는지 알 필요가 있다. Intellij나 Eclipse 등을 이용해 Java언어 코딩을 진행할때 많이 보았을 파일의 형식은 아마 .java였을 것이다. 그리고 컴파일을 하게 되면 out 폴더나(Intellij), bulid 폴더(eclipse)내에 동일한 이름의 .class 파일이 존재하는 것도 보았을 수 있다." /><meta property="og:description" content="JAVA의 전체적인 틀 동작원리를 알기 전에, 먼저 자바의 파일들이 어떻게 구성되어있는지 알 필요가 있다. Intellij나 Eclipse 등을 이용해 Java언어 코딩을 진행할때 많이 보았을 파일의 형식은 아마 .java였을 것이다. 그리고 컴파일을 하게 되면 out 폴더나(Intellij), bulid 폴더(eclipse)내에 동일한 이름의 .class 파일이 존재하는 것도 보았을 수 있다." /><link rel="canonical" href="https://vitriol95.github.io/posts/java_intro_1/" /><meta property="og:url" content="https://vitriol95.github.io/posts/java_intro_1/" /><meta property="og:site_name" content="Vitriol" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-05-10T11:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="자바(JVM)의 구동 원리 및 구조 - 1" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="QsbP4NOwVkaE8CnHpYOl-qNGhxB9m1RbsrBEefA92ao" /> <script type="application/ld+json"> {"headline":"자바(JVM)의 구동 원리 및 구조 - 1","dateModified":"2021-05-10T11:00:00+09:00","datePublished":"2021-05-10T11:00:00+09:00","description":"JAVA의 전체적인 틀 동작원리를 알기 전에, 먼저 자바의 파일들이 어떻게 구성되어있는지 알 필요가 있다. Intellij나 Eclipse 등을 이용해 Java언어 코딩을 진행할때 많이 보았을 파일의 형식은 아마 .java였을 것이다. 그리고 컴파일을 하게 되면 out 폴더나(Intellij), bulid 폴더(eclipse)내에 동일한 이름의 .class 파일이 존재하는 것도 보았을 수 있다.","url":"https://vitriol95.github.io/posts/java_intro_1/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://vitriol95.github.io/posts/java_intro_1/"},"@context":"https://schema.org"}</script><title>자바(JVM)의 구동 원리 및 구조 - 1 | Vitriol</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Vitriol"><meta name="application-name" content="Vitriol"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WSY4XYN711"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WSY4XYN711'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Vitriol</a></div><div class="site-subtitle font-italic">기억을 적는 시간</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/vitriol95" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['vitriol951','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>자바(JVM)의 구동 원리 및 구조 - 1</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>자바(JVM)의 구동 원리 및 구조 - 1</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> vitriol </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Mon, May 10, 2021, 11:00 AM +0900" prep="on" > May 10, 2021 <i class="unloaded">2021-05-10T11:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3212 words">17 min</span></div></div><div class="post-content"><h1 id="java의-전체적인-틀">JAVA의 전체적인 틀</h1><hr /><p>동작원리를 알기 전에, 먼저 자바의 파일들이 어떻게 구성되어있는지 알 필요가 있다. Intellij나 Eclipse 등을 이용해 Java언어 코딩을 진행할때 많이 보았을 파일의 형식은 아마 <code class="language-plaintext highlighter-rouge">.java</code>였을 것이다. 그리고 컴파일을 하게 되면 out 폴더나(Intellij), bulid 폴더(eclipse)내에 동일한 이름의 <code class="language-plaintext highlighter-rouge">.class</code> 파일이 존재하는 것도 보았을 수 있다.</p><p><br /> 전자의 경우는 우리가 직접 코딩을 할수 있도록 하는, 즉 사람이 직접 작업하거나 읽기 쉽도록 쓰여진 문서에 해당하고 후자는(아마 익스텐션이 없는 한 파일을 직접 열어서 보진 못했을 것이다.) 컴퓨터가 실행할 수 있도록 바이트코드로 작성된 파일에 해당한다.</p><p><br /> <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/java_study/1.PNG" /> 앞서 이야기한 <code class="language-plaintext highlighter-rouge">.java</code> 형식을 가진 파일들을 소스코드라고 한다. Intellij나 Eclipse에서 new Java Class라는 기능을 통해 클래스를 생성해본적이 있다면 모두 이러한 파일을 생성한 것이라 보면 된다.</p><p><br /> 이러한 파일을 컴파일하게 되면 <code class="language-plaintext highlighter-rouge">.class</code>로 확장자 명이 바뀐 파일이 생성되게 되고 이는 컴퓨터 파일이 실행할 수 있는 바이트 코드에 해당하게 된다. 여기서 Javac라고 하는 자바의 컴파일러가 이 작업을 수행한다. 마지막으로 이렇게 컴파일된 파일을 실제로 읽어들이고, 컴퓨터의 메모리 위에 올려 실제 어플리케이션을 실행하는 주체가 <strong>JVM(Java Virtual Machine)</strong> 에 해당한다.</p><h1 id="jvmjava-virtual-machine">JVM(Java Virtual Machine)</h1><hr /><p>앞서 말한 것들을 보면, ‘자바’라는 언어의 구동원리를 이해한다는 것은 결국 ‘JVM’의 동작원리를 이해한다는 것과 어느정도 일맥상통 하게 된다. JVM은 바이트코드(.class)를 실행시키는 주체에 해당하고, CPU와 OS에 독립적으로 동작한다.</p><h2 id="jvm의-구조">JVM의 구조</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/java_study/2.JPG" /> JVM은 크게 4가지 영역으로 나누어져 있다. 각각의 역할은 다음과 같다.</p><ol><li><strong>Class Loader</strong>: javac에 의해 컴파일 된 파일들을 JVM이 운영체제로부터 할당 받은 영역인 Runtime Data Area에 적재시켜준다.<li><strong>Execution Engine</strong>: Class Loader로 인해 메모리에 적재된 클래스들을 기계어로 변경해 명령단위로 실행한다. 작동방식에는 크게 2가지가 있다.<ul><li><code class="language-plaintext highlighter-rouge">Interpreter 방식</code>: 다른 인터프리터 언어들과 마찬가지로 명령어를 하나씩 수행해 나가는 기본적인 방법이다. 변환단계가 중첩이 되므로 전체적인 수행은 느리지만, 명령어 단위의 실행은 빠르다<li><code class="language-plaintext highlighter-rouge">JIT(Just In time) 방식</code>: 바이트코드를 모두 네이티브 코드로 변환시켜 둔 다음에, 이후엔 인터프리팅 없이 네이티브 코드를 바로바로 실행하는 방법이다. 초기에 변환하는 시간이 걸린다는 점을 제외하고는 전체 실행속도가 빠르다.</ul><li><strong>Garbage Collector</strong>: 말 그대로 쓰레기들을 모아주고 정리하는 역할을 하며 Runtime Data Area의 Heap메모리 영역 객체들 중, Stack 영역과 참조가 끊어진 객체들을 제거하는 역할을 한다. 이는 뒤에서 자세히 설명하겠다.<li><strong>Runtime Data Area</strong>: JVM의 실질적인 메모리 영역에 해당하고, 애플리케이션이 실행되면서 사용되는 데이터들이 올라가는 영역이다. 이 영역은 JVM의 메모리 관리 방식과 굉장히 밀접하기에 자세히 설명하겠다!</ol><hr /><h2 id="runtime-data-area">Runtime Data Area</h2><p>Runtime Data Area는 또 5개의 영역으로 나누어지게 되는데 각각은 다음과 같은 메모리를 관리한다. <img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/java_study/3.JPG" /></p><ul><li><strong>Method Area</strong>: 클래스파일에 대한 전체적인 메타데이터를 저장한다. 예를 들어 필드정보<code class="language-plaintext highlighter-rouge">(클래스의 멤버변수, 데이터 타입, 접근제어자)</code>, 메서드 정보<code class="language-plaintext highlighter-rouge">(메서드 명, 반환 타입, 접근제어자)</code>, 타입정보<code class="language-plaintext highlighter-rouge">(Class or Interface)</code>, Constant Pool<code class="language-plaintext highlighter-rouge">(문자 상수, 타입, 필드 등)</code>, static 변수 및 final 클래스 변수가 그것이다.</ul><blockquote><p>😀 필자는 여기서 Constant Pool이 뭔지 명확하게 정리가 되지 않아 조금 알아보았다. String으로 예를 들어보자면, String을 생성하는 방법에는 2가지가 존재한다. new를 이용한 방식과 리터럴(““)을 사용한 방식이다. 이를 비교하며 아례의 예시를 살펴보자</p></blockquote><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">test</span> <span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">String</span> <span class="n">a</span> <span class="o">=</span> <span class="s">"aaa"</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">b</span> <span class="o">=</span> <span class="s">"aaa"</span><span class="o">;</span>
        <span class="nc">String</span> <span class="n">c</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="s">"aaa"</span><span class="o">);</span>
        <span class="nc">String</span> <span class="n">d</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">String</span><span class="o">(</span><span class="s">"aaa"</span><span class="o">);</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span><span class="o">==</span><span class="n">b</span><span class="o">);</span> <span class="c1">// true</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">a</span><span class="o">==</span><span class="n">c</span><span class="o">);</span> <span class="c1">// false</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">c</span><span class="o">==</span><span class="n">d</span><span class="o">);</span> <span class="c1">// false</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>결과적으로 보자면 a와 b가 가리키는 주소값은 동일하다는 것이며 나머지는 모두 다르다는 것을 뜻한다. 이렇게 리터럴로 정의된 ‘aaa’가 가리키는 주소값은 어디에 존재할까? 바로 String Constant pool에 존재한다. 반면 new로 생성된 변수는 Constant pool에 등록되지 않고 heap에 존재하게 된다.</p></blockquote><ul><li><p><strong>Heap Area</strong>: new의 키워드로 생성된 객체(Object를 상속한 타입)및 배열들이 생성된느 영역에 해당한다. Method Area 내부에 존재하는 class만 생성이 가능한 형태이며 이곳이 Garbage Collector가 활동하는 영역이다.</p><li><strong>Stack Area</strong>: 지역변수나 파라미터, 리턴값, 연산에 사용되는 임시 값들을 저장하는 공간에 해당한다.<blockquote><p>Heap과 Stack영역은 뒤에서 더 자세히 다루도록 하겠다.</p></blockquote><li><p><strong>PC Register</strong>: Program Counter라는 뜻으로, 현재 쓰레드가 실행되는 부분의 주소와 명령을 저장하고 있는 영역에 해당한다. (CPU의 그것과는 다르다)</p><li><strong>Native Method Stack</strong>: 자바 외의 언어로 작성된 네이티브 코드(C 등등)를 위한 메모리 영역이다.</ul><p>여기서 중요한 것은 첫번째와 두번째 공간인 메소드와 힙 영역은 모든 쓰레드가 공유하는 메모리 영역에 해당하지만 나머지의 경우에는 각각의 쓰레드마다 가지고있으며 공유되지 않는다는 것이다.</p><hr /><h2 id="stack과-heap영역">Stack과 Heap영역</h2><p>이 두영역은 서로 상호작용을 하는 영역에 해당하면서 Garbage Collection을 진행할때 참조하는 영역에 해당한다. 이둘은 어떤 관계를 가지고 있는지 한번 살펴보자</p><h3 id="stack영역">Stack영역</h3><p>Heap영역에 생성된 Object 타입 데이터의 <strong>참조값</strong> 이 저장된다. 원시타입(primitive type - byte, short, int, long, boolean, char 등등)의 경우에는 <strong>데이터와 함께 값</strong> 이 저장된다. 이들은 특정한 visibility를 갖는데 이를 scope라고 하며 이 scope에 대한 정보 또한 함께 저장된다. (함수형 프로그래밍 언어의 scope개념과 유사하다)</p><p><br /> 어떠한 변수가 foo()라는 함수 내에서 할당된 경우에 해당 지역 변수는 다른 함수에서 접근할 수 없다(out of scope). 그리고 해당 함수가 사라졌을 경우 그 scope도 함께 사라지게 되므로 foo()함수가 종료되는 경우 이 함수 내부의 모든 지역변수들은 Stack에서 pop되어 사라진다. 다음과 같은 코드를 통해 확인해보자.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="kt">boolean</span> <span class="n">flag</span> <span class="o">=</span> <span class="kc">true</span><span class="o">;</span> <span class="c1">// 1</span>
        <span class="n">flag</span> <span class="o">=</span> <span class="n">reverseFlag</span><span class="o">(</span><span class="n">flag</span><span class="o">);</span> <span class="c1">// 5</span>
    <span class="o">}</span>
    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">reverseFlag</span><span class="o">(</span><span class="kt">boolean</span> <span class="n">b</span><span class="o">){</span> <span class="c1">// 2</span>
        <span class="kt">boolean</span> <span class="n">temp</span> <span class="o">=</span> <span class="o">!</span><span class="n">b</span><span class="o">;</span> <span class="c1">// 3</span>
        <span class="k">return</span> <span class="n">temp</span><span class="o">;</span>
    <span class="o">}</span> <span class="c1">// 4</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>주석에 달린 숫자에 따른 스택의 상태를 그림으로 표현해보자면 다음과 같이 나타난다. 여기서 파란색으로 된 변수들은 현재 활성화된 스코프를 뜻한다.</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/java_study/4.JPG" /></p><ol><li>1 ~ 2로 넘어가는 과정을 보자. 이때 스코프가 main()에서 reverseFlag()로 바뀌게 되며 여기서는 main()에서 정의된 flag라는 변수를 더이상 사용할 수 없다. boolean은 원시타입이므로 값과 함께 저장된다.<blockquote><p>이 개념은 함수형 언어(ex. JavaScript)의 스코프와 살짝 다르다. 여기서는 클로저라는 개념이 존재하지 않는다.</p></blockquote><li><p>이후 파라미터로 넘어온 b에 해당 하는 값 true가 새로 스택에 쌓이게 되고 temp라는 값이 새롭게 정의되고 이값 또한 스택에 쌓인다.</p><li><p>4번에 와서 reverseFlag 메서드가 종료하게 되면 기존의 reverseFlag()내의 변수였던 temp와 b는 모두 스택에서 pop이 된다.</p><li>5번에 오면 flag라는 값이 reverseFlag의 리턴값을 다시 받아 false로 변경되었고 이 값이 스택에 쌓이게 된다.</ol><hr /><h3 id="heap-영역">Heap 영역</h3><p>동적인 메모리 영역으로, Stack과 비교하였을 때 생명주기가 좀 더 긴 객체들이 저장되며 모든 Object 타입은 이 영역에 저장된다. 이 영역에 있는 Object를 가리키는 <strong>‘레퍼런스 변수’</strong> 가 Stack에 올라가게 된다. 또한 힙 내에 존재하는 Object가 힙 내에 존재하는 다른 Object를 참조하는 것도 가능하다(List와 같은 자료형).</p><p><br /> 이러한 Heap영역과 Stack영역이 어떻게 서로 연결되는지 코드와 그림을 통해 알아보자.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span><span class="o">{</span>
    
    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="nc">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">){</span>
        <span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">ll</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span> <span class="c1">// 1</span>
        <span class="n">ll</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"k"</span><span class="o">);</span>
        <span class="n">ll</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"o"</span><span class="o">);</span> <span class="c1">// 2</span>
        <span class="n">check</span><span class="o">(</span><span class="n">ll</span><span class="o">);</span> <span class="c1">// 5</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">check</span><span class="o">(</span><span class="nc">List</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="n">array</span><span class="o">){</span> <span class="c1">//3</span>
        <span class="nc">String</span> <span class="n">value</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="mi">0</span><span class="o">);</span>
        <span class="n">array</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="s">"a"</span><span class="o">);</span> <span class="c1">// 4</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/java_study/5.JPG" /></p><ol><li>가장 먼저 ll 이라는 리스트가 생성되고 이는 Object이므로 참조값인 ll이 스택에 올라오게된다.<li>add를 통해 String값들이 힙내부의 리스트의 참조를 받게된다. 이 값들은 스택에 올라가지 않는다.<li>이후 새로운 scope(check)가 열리게 되고 매개변수인 array가 이에 대한 참조를 이어간다. 이 scope에서 역시 main함수내의 ll은 접근이 불가능하다<li>새롭게 String이 추가되었는데 이는 arr가 가리키는 힙 영역내의 리스트에 참조가 추가되는 것이다.<li>이후 나오는 ll의 모습은 어떻게 될까? 바로 다음과 같이 바뀌어 있다.</ol><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/java_study/6.JPG" /></p><blockquote><p>a가 추가된 이유는 단순하다. 스택에서는 Object타입의 <strong>참조값</strong> 만 저장해두기 때문이다. 참조에도 여러 종류가 존재(Strong, Weak, Soft, Phantom)하지만 이러한 깊은 내용은 2편에서 다루겠다.</p></blockquote><p><br /> 추가적으로, 자바의 Wrapper 클래스들 (Integer, Character, Byte, Boolean, Long, Double, Float, Short 등)은 String과 함께 대표적인 Immutable 속성을 갖는다. 이러한 성질은 힙에서 보면 더 이해하기 쉽다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Main</span><span class="o">{</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(){</span>
        <span class="nc">Integer</span> <span class="n">num</span> <span class="o">=</span> <span class="mi">10</span><span class="o">;</span> <span class="c1">// 1</span>
        <span class="n">num</span> <span class="o">+=</span> <span class="mi">15</span><span class="o">;</span> <span class="c1">// 2</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이 경우의 힙과 스택은 다음과 같다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/java_study/7.JPG" /></p><p>1번 에서는 stack의 num이 heap의 10을 참조하고 있지만 2의 연산이 들어오게 되면 num이 바로 25로 바뀌어 버리는 것이 아니다. 이는 앞서말한 Integer의 Immutable 때문이다. 즉, 힙에서 다시 Integer 25라는 값을 <strong>만들어 내고</strong> 이에 대한 num의 참조를 옮기는 것에 해당한다.</p><blockquote><p>엄밀히 따지면, 사실 num이 처음에 참조하는 Integer 10이라는 값은 Constant Pool에서 나온 것에 해당하므로 위의 그림은 적합하지 않다. new를 통해서 생성된 경우가 알맞다.</p></blockquote><blockquote><p>여기서 남은 Integer 10은 어떻게 될까? 이는 스택에서 참조되지 않는 상태(unreachable)에 해당하며 이러한 객체들이 바로 Garbage Collection의 대상이 된다.</p></blockquote><h1 id="참고자료">참고자료</h1><hr /><p>출처 : <a href="https://joalog.tistory.com/6">https://joalog.tistory.com/6</a> <br /> 출처 : <a href="https://jeong-pro.tistory.com/148">https://jeong-pro.tistory.com/148</a> <br /> 출처 : <a href="https://www.oracle.com/java/technologies/javase/gc-tuning-6.html">https://www.oracle.com/java/technologies/javase/gc-tuning-6.html</a> <br /> 출처 : <a href="https://yaboong.github.io/java/2018/05/26/java-memory-management/">https://yaboong.github.io/java/2018/05/26/java-memory-management/</a><br /> 모두 정말 도움 많이되었습니다 감사합니다.!</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/java/'>Java</a>, <a href='/categories/java-study/'>java_study</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a> <a href="/tags/jvm/" class="post-tag no-text-decoration" >jvm</a> <a href="/tags/%EC%9E%90%EB%B0%94/" class="post-tag no-text-decoration" >자바</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=자바(JVM)의 구동 원리 및 구조 - 1 - Vitriol&url=https://vitriol95.github.io/posts/java_intro_1/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=자바(JVM)의 구동 원리 및 구조 - 1 - Vitriol&u=https://vitriol95.github.io/posts/java_intro_1/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=자바(JVM)의 구동 원리 및 구조 - 1 - Vitriol&url=https://vitriol95.github.io/posts/java_intro_1/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/batchbase1/">스프링 배치 - 1 스프링 배치란?</a><li><a href="/posts/batchbase2/">스프링 배치 - 2 DB 스키마에 대한 이해</a><li><a href="/posts/batchbase3/">스프링 배치 - 3 도메인 뜯어보기(JOB)</a><li><a href="/posts/batchbase4/">스프링 배치 - 4 도메인 뜯어보기(STEP)</a><li><a href="/posts/batchbase5/">스프링 배치 - 5 청크 지향 처리</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">백준</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/java_intro_2/"><div class="card-body"> <span class="timeago small" > May 10, 2021 <i class="unloaded">2021-05-10T15:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바(JVM)의 구동 원리 및 구조 - 2</h3><div class="text-muted small"><p> 이전 포스트 - 자바(JVM)의 구동 원리 및 구조 - 1 저번 시간에는 자바의 전체적인 틀과함께 JVM의 구조를 알아보았다. 그 중에서 JVM의 메모리에 해당하는 Runtime Data Area 영역에 대해서 자세히 알아보았고 그중에서도 Stack과 Heap영역에 데이터가 쌓이는 방식에 대해 알아보았다. 이번시간에는 JVM의 Garbage Col...</p></div></div></a></div><div class="card"> <a href="/posts/java_intro_3/"><div class="card-body"> <span class="timeago small" > May 10, 2021 <i class="unloaded">2021-05-10T17:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바(JVM)의 구동 원리 및 구조 - 3</h3><div class="text-muted small"><p> 이전 포스트 - 자바(JVM)의 구동 원리 및 구조 - 1 이전 포스트 - 자바(JVM)의 구동 원리 및 구조 - 2 JVM의 구조와 그 중 Garbage Collector의 역할에 대해서 알아보았다. 이번 포스트부터는 심화적인 내용에 들어갈 예정인데, 가장 첫번째로 ‘참조(Reference)’에 대해서 알아보려 한다. 레퍼런스 1편에 있었던...</p></div></div></a></div><div class="card"> <a href="/posts/java_intro_4/"><div class="card-body"> <span class="timeago small" > May 11, 2021 <i class="unloaded">2021-05-11T17:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>자바(JVM)의 구동 원리 및 구조 - 4</h3><div class="text-muted small"><p> 이전 포스트 - 자바(JVM)의 구동 원리 및 구조 - 1 이전 포스트 - 자바(JVM)의 구동 원리 및 구조 - 2 이전 포스트 - 자바(JVM)의 구동 원리 및 구조 - 3 저번 시간에는 GC에 있어 여러가지 참조 형태와 사용자 코드의 개입에 대해서 이야기 해보았는데, 마지막으로 GC의 여러 알고리즘을 이야기하고자 한다. GC과정에서 가장 ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/boj2263/" class="btn btn-outline-primary" prompt="Older"><p>백준 2263 트리의 순회 with Python</p></a> <a href="/posts/java_intro_2/" class="btn btn-outline-primary" prompt="Newer"><p>자바(JVM)의 구동 원리 및 구조 - 2</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">vitriol</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">백준</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://vitriol95.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
