<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(5)" /><meta property="og:locale" content="ko" /><meta name="description" content="ì´ì „ ê¸€" /><meta property="og:description" content="ì´ì „ ê¸€" /><link rel="canonical" href="https://vitriol95.github.io/posts/mvcproject5/" /><meta property="og:url" content="https://vitriol95.github.io/posts/mvcproject5/" /><meta property="og:site_name" content="Vitriol" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-05T11:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(5)" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="QsbP4NOwVkaE8CnHpYOl-qNGhxB9m1RbsrBEefA92ao" /> <script type="application/ld+json"> {"headline":"ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(5)","dateModified":"2021-06-05T11:00:00+09:00","datePublished":"2021-06-05T11:00:00+09:00","description":"ì´ì „ ê¸€","url":"https://vitriol95.github.io/posts/mvcproject5/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://vitriol95.github.io/posts/mvcproject5/"},"@context":"https://schema.org"}</script><title>ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(5) | Vitriol</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Vitriol"><meta name="application-name" content="Vitriol"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WSY4XYN711"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WSY4XYN711'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Vitriol</a></div><div class="site-subtitle font-italic">ê¸°ì–µì„ ì ëŠ” ì‹œê°„</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/vitriol95" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['vitriol951','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG â€º <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(5)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(5)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> vitriol </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sat, Jun 5, 2021, 11:00 AM +0900" prep="on" > Jun 5, 2021 <i class="unloaded">2021-06-05T11:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3238 words">17 min</span></div></div><div class="post-content"><h1 id="ì´ì „-ê¸€">ì´ì „ ê¸€</h1><p><a href="https://vitriol95.github.io/posts/mvcproject4/">ì´ì „ê¸€</a> ì—ì„œëŠ” ìˆ˜ì •ì‚¬í•­ê³¼ ë‹¨ìœ„í…ŒìŠ¤íŠ¸, ë§ˆì§€ë§‰ìœ¼ë¡œ Reply ì—”í‹°í‹°ë¥¼ ì •ì˜í•˜ê³  ì–‘ë°©í–¥ ë§¤í•‘ê¹Œì§€ ì™„ë£Œí•˜ì˜€ë‹¤. ì´ë²ˆì‹œê°„ì—ëŠ” Replyê°ì²´ê°€ ë“¤ì–´ì˜´ìœ¼ë¡œì¨ ë°œìƒí•˜ëŠ” ì»¨íŠ¸ë¡¤ëŸ¬ì™€ ë·°ë‹¨ì˜ ë³€í™”ë¥¼ ì ìš©í•˜ê³  Replyì˜ ë“±ë¡ ë° ì‚­ì œê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³´ì. ë“±ë¡ê³¼ì •ì—ì„œëŠ” ë¹„ë™ê¸° í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ ajaxë¥¼ ì‚¬ìš©í•´ ë³´ê² ë‹¤.</p><hr /><h1 id="í¬ìŠ¤íŠ¸-ìƒì„¸ë³´ê¸°-ë·°--ì»¨íŠ¸ë¡¤ëŸ¬-ìˆ˜ì •">í¬ìŠ¤íŠ¸ ìƒì„¸ë³´ê¸° ë·° / ì»¨íŠ¸ë¡¤ëŸ¬ ìˆ˜ì •</h1><p>í¬ìŠ¤íŠ¸ ìƒì„¸ë³´ê¸° ë·°ì— Replyê°ì²´ë¥¼ ì ìš©í•´ì•¼í•œë‹¤. htmlíŒŒì¼ì€ ë‹¤ìŒê³¼ ê°™ì´ ì •ì˜ëœë‹¤.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
</pre><td class="rouge-code"><pre><span class="c">&lt;!-- ìˆ˜ì •ëœ post/view.html íŒŒì¼ --&gt;</span>
<span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html</span> <span class="na">lang=</span><span class="s">"en"</span> <span class="na">xmlns:th=</span><span class="s">"http://www.thymeleaf.org"</span> <span class="na">xmlns:sec=</span><span class="s">"http://thymeleaf.org/extras/spring-security"</span><span class="nt">&gt;</span>
<span class="nt">&lt;head</span> <span class="na">th:replace=</span><span class="s">"fragments.html::head"</span><span class="nt">&gt;</span>

<span class="nt">&lt;/head&gt;</span>
<span class="nt">&lt;body&gt;</span>
    <span class="nt">&lt;nav</span> <span class="na">th:replace=</span><span class="s">"fragments.html :: main-nav"</span><span class="nt">&gt;&lt;/nav&gt;</span>

    <span class="nt">&lt;main</span> <span class="na">role=</span><span class="s">"main"</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-flex align-items-center p-3 my-3 bg-purple rounded shadow-sm"</span> <span class="na">style=</span><span class="s">"justify-content: space-between"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"lh-200"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"mb-0 lh-200"</span> <span class="na">th:text=</span><span class="s">"${post.title}"</span><span class="nt">&gt;</span>Bootstrap<span class="nt">&lt;/h3&gt;</span>
                <span class="nt">&lt;small</span> <span class="na">th:text=</span><span class="s">"${#temporals.format(post.modifiedDate,'yyyy-MM-dd HH:mm')}"</span><span class="nt">&gt;</span>localdate<span class="nt">&lt;/small&gt;</span>
            <span class="nt">&lt;/div&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"lh-200"</span> <span class="na">th:if=</span><span class="s">"${post.isWriter(#authentication.principal)}"</span><span class="nt">&gt;</span>

                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group mb-0"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">th:href=</span><span class="s">"@{'/posts/'+${post.getId()}+'/update'}"</span><span class="nt">&gt;&lt;button</span> <span class="na">name=</span><span class="s">"update"</span> <span class="na">class=</span><span class="s">"btn btn-outline-primary"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>ìˆ˜ì •<span class="nt">&lt;/button&gt;&lt;/a&gt;</span>
                <span class="nt">&lt;/div&gt;</span>

                <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-inline"</span> <span class="na">th:if=</span><span class="s">"${post.isWriter(#authentication.principal)}"</span> <span class="na">action=</span><span class="s">"#"</span> <span class="na">th:action=</span><span class="s">"@{'/posts/' + ${post.getId()} + '/delete'}"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"delete"</span> <span class="na">class=</span><span class="s">"btn btn-outline-danger"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>ì‚­ì œ<span class="nt">&lt;/button&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-flex align-items-center p-3 my-3 bg-purple rounded shadow-sm"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"lh-100"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;svg</span> <span class="na">th:if=</span><span class="s">"${#strings.isEmpty(post.account?.profileImage)}"</span> <span class="na">data-jdenticon-value=</span><span class="s">"user111"</span> <span class="na">th:data-jdenticon-value=</span><span class="s">"${post.account.email}"</span>
                     <span class="na">width=</span><span class="s">"32"</span> <span class="na">height=</span><span class="s">"32"</span> <span class="na">class=</span><span class="s">"rounded boarder bg-light"</span><span class="nt">&gt;&lt;/svg&gt;</span>
                <span class="nt">&lt;img</span> <span class="na">th:if=</span><span class="s">"${!#strings.isEmpty(post.account?.profileImage)}"</span> <span class="na">th:src=</span><span class="s">"${post.account.profileImage}"</span>
                     <span class="na">width=</span><span class="s">"32"</span> <span class="na">height=</span><span class="s">"32"</span> <span class="na">class=</span><span class="s">"rounded boarder bg-light"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"lh-100 h6 mb-0"</span> <span class="na">th:text=</span><span class="s">"${post.account.nickname}"</span><span class="nt">&gt;&lt;/span&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"my-3 p-3 bg-white rounded shadow-sm"</span> <span class="na">th:utext=</span><span class="s">"${post.description}"</span><span class="nt">&gt;</span>

        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"comments"</span> <span class="na">th:fragment=</span><span class="s">"comments"</span> <span class="na">class=</span><span class="s">"my-3 p-3 bg-white rounded shadow-sm"</span><span class="nt">&gt;</span>

            <span class="nt">&lt;h6</span> <span class="na">class=</span><span class="s">"border-bottom border-gray pb-2 mb-0"</span><span class="nt">&gt;&lt;strong&gt;</span>ì½”ë©˜íŠ¸<span class="nt">&lt;/strong&gt;&lt;/h6&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"media text-muted pt-3"</span> <span class="na">th:each=</span><span class="s">"reply: ${post.replies}"</span><span class="nt">&gt;</span>

                <span class="nt">&lt;svg</span> <span class="na">class=</span><span class="s">"bd-placeholder-img mr-2 rounded"</span> <span class="na">th:if=</span><span class="s">"${#strings.isEmpty(reply.account?.profileImage)}"</span> <span class="na">data-jdenticon-value=</span><span class="s">"user111"</span> <span class="na">th:data-jdenticon-value=</span><span class="s">"${reply.account.email}"</span>
                     <span class="na">width=</span><span class="s">"32"</span> <span class="na">height=</span><span class="s">"32"</span><span class="nt">&gt;&lt;/svg&gt;</span>
                <span class="nt">&lt;img</span> <span class="na">th:if=</span><span class="s">"${!#strings.isEmpty(reply.account?.profileImage)}"</span> <span class="na">th:src=</span><span class="s">"${reply.account.profileImage}"</span>
                     <span class="na">width=</span><span class="s">"32"</span> <span class="na">height=</span><span class="s">"32"</span> <span class="na">class=</span><span class="s">"bd-placeholder-img mr-2 rounded"</span><span class="nt">&gt;</span>

                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"media-body pb-3 mb-0 small lh-125 border-bottom border-gray"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-flex justify-content-between align-items-center w-100"</span><span class="nt">&gt;</span>
                        <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"text-gray-dark"</span> <span class="na">th:text=</span><span class="s">"${reply.account.nickname}"</span><span class="nt">&gt;</span>Full Name<span class="nt">&lt;/strong&gt;</span>
                        <span class="nt">&lt;span&gt;</span>
                            <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-inline"</span> <span class="na">th:if=</span><span class="s">"${reply.isWriter(#authentication.principal)}"</span> <span class="na">th:action=</span><span class="s">"@{'/posts/' + ${post.getId()} + '/reply/' +${reply.getId()}+'/delete'}"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
                                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                                    <span class="nt">&lt;button</span> <span class="na">name=</span><span class="s">"delete"</span> <span class="na">class=</span><span class="s">"btn btn-link btn-sm"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>ì‚­ì œ<span class="nt">&lt;/button&gt;</span>
                                <span class="nt">&lt;/div&gt;</span>
                            <span class="nt">&lt;/form&gt;</span>
                        <span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                    <span class="nt">&lt;span</span> <span class="na">th:text=</span><span class="s">"${#temporals.format(reply.modifiedDate,'yyyy-MM-dd HH:mm')}"</span><span class="nt">&gt;</span>@username<span class="nt">&lt;/span&gt;</span>
                    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"mt-1 text-dark"</span>  <span class="na">th:utext=</span><span class="s">"${reply.description}"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>


            <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"d-block text-right mt-3"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>All suggestions<span class="nt">&lt;/a&gt;</span>
            <span class="nt">&lt;/small&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"needs-validation col-sm-10"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;label</span> <span class="na">for=</span><span class="s">"replyDescription"</span><span class="nt">&gt;</span>ì½”ë©˜íŠ¸ ì‘ì„±<span class="nt">&lt;/label&gt;</span>
                    <span class="nt">&lt;textarea</span> <span class="na">name=</span><span class="s">"replyDescription"</span> <span class="na">id=</span><span class="s">"replyDescription"</span> <span class="na">class=</span><span class="s">"editor form-control"</span> <span class="na">placeholder=</span><span class="s">"ë³¸ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”"</span>
                              <span class="na">aria-describedby=</span><span class="s">"replyDescriptionHelp"</span> <span class="na">required</span> <span class="na">minlength=</span><span class="s">"2"</span><span class="nt">&gt;&lt;/textarea&gt;</span>
                    <span class="nt">&lt;small</span> <span class="na">id=</span><span class="s">"replyDescriptionHelp"</span> <span class="na">class=</span><span class="s">"form-text text-muted"</span><span class="nt">&gt;</span>
                        ë§¤ë„ˆë¥¼ ì§€ì¼œ ì‘ì„±í•´ì£¼ì„¸ìš”.
                    <span class="nt">&lt;/small&gt;</span>
                    <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"invalid-feedback"</span><span class="nt">&gt;</span>2ê¸€ì ì´ìƒì´ ì™€ì•¼í•©ë‹ˆë‹¤.<span class="nt">&lt;/small&gt;</span>
                <span class="nt">&lt;/div&gt;</span>

                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"replySave"</span> <span class="na">class=</span><span class="s">"btn btn-primary btn-block"</span> <span class="na">type=</span><span class="s">"button"</span><span class="nt">&gt;</span>ì½”ë©˜íŠ¸ ë‹¬ê¸°<span class="nt">&lt;/button&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/main&gt;</span>
    <span class="nt">&lt;script </span><span class="na">th:replace=</span><span class="s">"fragments.html :: form-validation"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">href=</span><span class="s">"https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.css"</span> <span class="na">rel=</span><span class="s">"stylesheet"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;script </span><span class="na">src=</span><span class="s">"https://cdn.jsdelivr.net/npm/summernote@0.8.18/dist/summernote.min.js"</span><span class="nt">&gt;&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">th:fragment=</span><span class="s">"summerNote"</span> <span class="na">type=</span><span class="s">"application/javascript"</span><span class="nt">&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
            <span class="nx">$</span><span class="p">(</span><span class="dl">'</span><span class="s1">.editor</span><span class="dl">'</span><span class="p">).</span><span class="nx">summernote</span><span class="p">({</span>
                <span class="na">placeholder</span><span class="p">:</span> <span class="dl">'</span><span class="s1">ê³µë°±ë§Œ ìˆëŠ” ê¸€ì€ í—ˆìš©ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</span><span class="dl">'</span><span class="p">,</span>
                <span class="na">tabSize</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                <span class="na">height</span><span class="p">:</span> <span class="mi">100</span>
            <span class="p">});</span>
        <span class="p">})</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;script </span><span class="na">type=</span><span class="s">"application/javascript"</span> <span class="na">th:inline=</span><span class="s">"javascript"</span><span class="nt">&gt;</span>
        <span class="nx">$</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">var</span> <span class="nx">csrfToken</span> <span class="o">=</span> <span class="cm">/*[[${_csrf.token}]]*/</span> <span class="kc">null</span><span class="p">;</span>
            <span class="kd">var</span> <span class="nx">csrfHeader</span> <span class="o">=</span> <span class="cm">/*[[${_csrf.headerName}]]*/</span> <span class="kc">null</span><span class="p">;</span>
            <span class="nx">$</span><span class="p">(</span><span class="nb">document</span><span class="p">).</span><span class="nx">ajaxSend</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">xhr</span><span class="p">,</span> <span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
                <span class="nx">xhr</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="nx">csrfHeader</span><span class="p">,</span> <span class="nx">csrfToken</span><span class="p">);</span>
            <span class="p">});</span>
        <span class="p">});</span>
    <span class="nt">&lt;/script&gt;</span>
    <span class="nt">&lt;script&gt;</span>
        <span class="kd">let</span> <span class="nx">index</span> <span class="o">=</span> <span class="p">{</span>
            <span class="na">init</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#replySave</span><span class="dl">"</span><span class="p">).</span><span class="nx">on</span><span class="p">(</span><span class="dl">"</span><span class="s2">click</span><span class="dl">"</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nx">replySave</span><span class="p">();</span>
                <span class="p">});</span>
            <span class="p">},</span>
            <span class="na">replySave</span><span class="p">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
                <span class="kd">let</span> <span class="nx">description</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="dl">"</span><span class="s2">#replyDescription</span><span class="dl">"</span><span class="p">).</span><span class="nx">val</span><span class="p">();</span>
                <span class="kd">let</span> <span class="nx">postId</span> <span class="o">=</span> <span class="p">[[</span><span class="nx">$</span><span class="p">{</span><span class="nx">post</span><span class="p">.</span><span class="nx">id</span><span class="p">}]];</span>
                <span class="kd">let</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span><span class="na">description</span><span class="p">:</span> <span class="nx">description</span><span class="p">};</span>
                <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
                    <span class="na">contentType</span><span class="p">:</span> <span class="dl">"</span><span class="s2">application/json; charset=utf8</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">method</span><span class="p">:</span> <span class="dl">"</span><span class="s2">POST</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">url</span><span class="p">:</span> <span class="dl">"</span><span class="s2">/posts/</span><span class="dl">"</span> <span class="o">+</span> <span class="nb">String</span><span class="p">(</span><span class="nx">postId</span><span class="p">)</span> <span class="o">+</span> <span class="dl">"</span><span class="s2">/reply</span><span class="dl">"</span><span class="p">,</span>
                    <span class="na">data</span><span class="p">:</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">),</span>
                <span class="p">}).</span><span class="nx">done</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">response</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">location</span><span class="p">.</span><span class="nx">reload</span><span class="p">();</span>
                <span class="p">}).</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">a</span><span class="p">,</span><span class="nx">b</span><span class="p">,</span><span class="nx">c</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">alert</span><span class="p">(</span><span class="nx">c</span><span class="p">)</span>
                <span class="p">});</span>
            <span class="p">}</span>
        <span class="p">};</span>
        <span class="nx">index</span><span class="p">.</span><span class="nx">init</span><span class="p">();</span>
    <span class="nt">&lt;/script&gt;</span>
<span class="nt">&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>43ë¼ì¸ë¶€í„° 69ë¼ì¸ì´ í˜„ì¬ í¬ìŠ¤íŠ¸ì— ì‘ì„±ëœ ëŒ“ê¸€ë“¤ì„ ë³´ì—¬ì£¼ëŠ” ê³³ì— í•´ë‹¹í•œë‹¤. ë˜í•œ 76ë¼ì¸ë¶€í„° 90ë¼ì¸ê¹Œì§€ê°€ ìƒˆë¡œìš´ ëŒ“ê¸€ì„ ë“±ë¡í•˜ëŠ” ì°½ì— í•´ë‹¹í•œë‹¤(Summernoteë¥¼ ì ìš©í•˜ì˜€ë‹¤.) ì´ë“¤ì˜ ë·° ë¡œì§ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><p><br /></p><ol><li>ëŒ“ê¸€ì„ ë‚¨ê¸¸ê²½ìš° ë·°ë‹¨ì— ëŒ“ê¸€ì„ ë‹¨ ì‚¬ìš©ìì˜ í”„ë¡œí•„ ì´ë¯¸ì§€, ë‹‰ë„¤ì„ê³¼ ë³¸ë¬¸ì´ ë‚˜íƒ€ë‚˜ê²Œ ëœë‹¤.<li>ëŒ“ê¸€ ì‘ì„±ìì˜ ê²½ìš°ì—ë§Œ ì‚­ì œ ë²„íŠ¼ì— ì ‘ê·¼í•  ìˆ˜ ìˆë‹¤.<blockquote><p>ì—­ì‹œ principalì„ ë§¤ê°œë³€ìˆ˜ë¡œ í•œ isWriter ë©”ì„œë“œê°€ í•„ìš”í•˜ë‹¤</p></blockquote><li>ëŒ“ê¸€ ì‘ì„±ì‹œ, descriptionë§Œ propertyë¡œ ê°€ì§„ newReplyFormì— ì •ë³´ê°€ ë‹´ê²¨ ì„œë²„ìª½ìœ¼ë¡œ ë„˜ì–´ì˜¤ê²Œ ëœë‹¤.<li>ëŒ“ê¸€ ì‘ì„± ì‘ì—…ì€ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì´ë£¨ì–´ì§€ê²Œ ë˜ë©° (114~138) ajaxë°©ì‹ìœ¼ë¡œ ì „ë‹¬ ëœë‹¤. ì´ë•Œ csrfí† í°ì„ ë„£ì–´ì£¼ì–´ì•¼ ìœ íš¨í•˜ë‹¤(105~113).<blockquote><p>ajax ìš”ì²­ì´ ì„±ê³µí•˜ë©´ (success) ì—¬ê¸°ì„œëŠ” location.reload()ë¡œ í˜ì´ì§€ë¥¼ refreshí•˜ê³  ìˆë‹¤. ì‚¬ì‹¤ ì´ë ‡ê²Œ í˜ì´ì§€ë¥¼ ê°±ì‹ í•œë‹¤ë©´ ajaxë¥¼ ì´ìš©í•˜ëŠ” ì¥ì ì´ ì—†ì–´ì§„ë‹¤. í•´ê²°ë²•ìœ¼ë¡œëŠ” replaceWith ë©”ì„œë“œë¥¼ ì´ìš©í•´ í•„ìš”í•œ í™”ë©´ë§Œ ê°±ì‹ í•  ìˆ˜ ìˆë‹¤. í•˜ì§€ë§Œ ì´ í”„ë¡œì íŠ¸ì—ì„œëŠ” ë¹„ë™ê¸° í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•œ ìš©ë„ì´ë¯€ë¡œ ë„˜ì–´ê°€ë„ë¡ í•˜ì.</p></blockquote><li>ëŒ“ê¸€ ì‚­ì œì˜ ê²½ìš° ë‹¨ìˆœí•œ postìš”ì²­ìœ¼ë¡œ ë„˜ì–´ê°€ê²Œ ëœë‹¤. (59ë¼ì¸)</ol><p><br /> ì´ ë·°ì— ëŒ€í•œ í•¸ë“¤ëŸ¬ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •ëœë‹¤.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre><td class="rouge-code"><pre><span class="c1">// PostController.class</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/posts/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">postView</span><span class="o">(</span><span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">findPostWithUserAndRepliesById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">post</span><span class="o">.</span><span class="na">isOpen</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"post"</span><span class="o">,</span> <span class="n">post</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="k">new</span> <span class="nc">NewReplyForm</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">"post/view"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/posts/{id}/reply"</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span> <span class="nf">replyFormSubmit</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> 
                                            <span class="nd">@RequestBody</span> <span class="nc">NewReplyForm</span> <span class="n">newReplyForm</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postService</span><span class="o">.</span><span class="na">getVanillaPost</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">postService</span><span class="o">.</span><span class="na">createNewReply</span><span class="o">(</span><span class="n">modelMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">newReplyForm</span><span class="o">,</span> <span class="nc">Reply</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">post</span><span class="o">,</span> <span class="n">account</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/posts/{postId}/reply/{replyId}/delete"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">deleteReplySubmit</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"postId"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> 
                                        <span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"replyId"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">replyId</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postService</span><span class="o">.</span><span class="na">getVanillaPost</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="nc">Reply</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">replyRepository</span><span class="o">.</span><span class="na">findReplyById</span><span class="o">(</span><span class="n">replyId</span><span class="o">);</span>
        <span class="n">postService</span><span class="o">.</span><span class="na">deleteReply</span><span class="o">(</span><span class="n">reply</span><span class="o">,</span> <span class="n">post</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"redirect:/posts/"</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>ë³€í™”ëœ ìƒí™©ì„ í•˜ë‚˜ì”© ì‚´í´ë³´ì.</p><hr /><h2 id="í¬ìŠ¤íŠ¸-ìƒì„¸ë³´ê¸°postsid-ì»¨íŠ¸ë¡¤ëŸ¬">í¬ìŠ¤íŠ¸ ìƒì„¸ë³´ê¸°(/posts/{id}) ì»¨íŠ¸ë¡¤ëŸ¬</h2><p>ì•ì„  ë·°ë¥¼ ë³´ì—¬ì£¼ëŠ” í•¸ë“¤ëŸ¬ì— í•´ë‹¹í•œë‹¤. ìœ„ì—ì„œ ë³´ì•˜ë“¯ì´, Postê°ì²´ë¥¼ í•˜ë‚˜ ê°€ì ¸ì™€ì„œ ì—°ê²°ëœ Accountì™€ Replyë“¤ì„ ëª¨ë‘ ê¸ì–´ì˜¤ê³  ìˆë‹¤. ì´ëŠ” <code class="language-plaintext highlighter-rouge">Post post = postRepository.findPostWithUserAndRepliesById(id)</code> ë¼ëŠ” ë©”ì„œë“œë¥¼ í†µí•´ ê¸ì–´ì˜¨ë‹¤. ì´ëŠ” ë‹¤ìŒê³¼ ê°™ì´ êµ¬í˜„ë˜ì–´ìˆë‹¤.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PostRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="nd">@EntityGraph</span><span class="o">(</span><span class="n">attributePaths</span> <span class="o">=</span> <span class="o">{</span><span class="s">"description"</span><span class="o">,</span><span class="s">"account"</span><span class="o">,</span><span class="s">"replies"</span><span class="o">},</span> <span class="n">type</span> <span class="o">=</span> <span class="nc">EntityGraph</span><span class="o">.</span><span class="na">EntityGraphType</span><span class="o">.</span><span class="na">LOAD</span><span class="o">)</span>
    <span class="nc">Post</span> <span class="nf">findPostWithUserAndRepliesById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>

    <span class="cm">/**
    ì´ì „ ì½”ë“œë“¤
    */</span>

<span class="o">}</span>

</pre></table></code></div></div><p>ìœ„ì˜ @EntityGraphë¥¼ ì´ìš©í•˜ì—¬ Lazyë¡œ ì„¤ì •ëœ attributeë“¤ì„ ëª¨ë‘ ê¸ì–´ì˜¤ê³  ìˆë‹¤. ì´ë ‡ê²Œ ë˜ë©´ ë·°ì— ë³¸ë¬¸ê³¼, ê¸€ì“´ì´ì— ëŒ€í•œ ì •ë³´, ëŒ“ê¸€ë“¤ì„ ëª¨ë‘ ê°€ì ¸ì˜¬ ìˆ˜ ìˆë‹¤.</p><p><br /> ğŸ¤” í•˜ì§€ë§Œ í•œê°€ì§€ ì˜ë¬¸ì ì´ ë“ ë‹¤. ë·°ë¥¼ ë‹¤ì‹œë³´ë©´, ìš°ë¦¬ëŠ” Replyë“¤ì˜ Accountë„ í•„ìš”í•˜ë‹¤. ì¦‰, ëŒ“ê¸€ì´ ë³´ì—¬ì§ˆ ë•Œ ëŒ“ê¸€ì“´ì´ì˜ í”„ë¡œí•„ê³¼ ë‹‰ë„¤ì„ì´ í•¨ê»˜ ë³´ì—¬ì ¸ì•¼ í•˜ë¯€ë¡œ ì´ê²ƒê¹Œì§€ ê¸ì–´ì™€ì•¼ í•œë‹¤ëŠ” ê²ƒì´ë‹¤. ê·¸ë¦¼ìœ¼ë¡œ ë‚˜íƒ€ë‚´ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/16.JPG" /></p><p>Post ì—”í‹°í‹°ì˜ ë³¸ë¬¸, Reply, Account(ê¸€ì“´ì´)ëŠ” @EntityGraphë¥¼ í†µí•´ í•œêº¼ë²ˆì— ê°€ì ¸ì™€ì§€ëŠ” ë°˜ë©´ Replyì—”í‹°í‹°ì™€ ì—°ê²°ëœ Account(ëŒ“ê¸€ì“´ì´)ëŠ” LAZYì— í•´ë‹¹í•˜ë¯€ë¡œ í”„ë¡ì‹œ ê°ì²´ê°€ ìë¦¬í•  ê²ƒì´ë‹¤. ë”°ë¼ì„œ ë·°ë‹¨ìœ¼ë¡œ <code class="language-plaintext highlighter-rouge">reply.account.profileImage</code>ì™€ ê°™ì€ í”„ë¡œí¼í‹°ë¥¼ ì†Œí™˜í•  ê²½ìš° ì—ëŸ¬ë¥¼ ë±‰ì–´ë‚¼ ê²ƒì´ë‹¤.</p><p><br /> ì´ë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì—ëŠ” 2ê°€ì§€ê°€ ì¡´ì¬í•œë‹¤.</p><ol><li>Reply Entityì˜ Account í”„ë¡œí¼í‹° FetchTypeì„ EAGERë¡œ ë°”ê¾¼ë‹¤.<li>ë„¤ì´í‹°ë¸Œ ì¿¼ë¦¬ë‚˜ QueryDSLì„ ì´ìš©í•˜ì—¬ ìƒˆë¡œìš´ ì¿¼ë¦¬ë¥¼ ì •ì˜í•œë‹¤.</ol><p>í•„ìëŠ” 2ë²ˆë°©ë²•ì„ ì‹œë„í•˜ë˜ ì¤‘, ì ì‹œ ìƒê°ì´ ë– ì˜¬ëë‹¤. â€˜Account(ëŒ“ê¸€ì“´ì´)ê°€ ì—†ëŠ” ìƒíƒœë¡œ Replyê°€ ë³´ì—¬ì§ˆ ì¼ì´ ìˆëŠ”ê°€?â€™ ë‹µì€ Noì˜€ë‹¤. ë”°ë¼ì„œ 1ë²ˆ ë°©ì‹ìœ¼ë¡œ ìš°íšŒí•˜ì—¬ ì§„í–‰í•˜ì˜€ë‹¤.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"reply"</span><span class="o">)</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Reply</span> <span class="kd">extends</span> <span class="nc">LocalDateTimeEntity</span> <span class="o">{</span>

    <span class="cm">/**
    ì´ì „ ì½”ë“œë“¤
    */</span>
    <span class="nd">@ManyToOne</span>
    <span class="kd">private</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">;</span>

    <span class="cm">/**
    ì´ì „ ì½”ë“œë“¤
    */</span>
<span class="o">}</span>
</pre></table></code></div></div><p>ë‹¤ìŒê³¼ ê°™ì´ ì§„í–‰í•˜ë©´ ì•ì„  <code class="language-plaintext highlighter-rouge">findPostWithUserAndRepliesById</code>ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ Replyì˜ Accountê¹Œì§€ ëª¨ë‘ ê°€ì ¸ì˜¤ê²Œ ëœë‹¤.</p><hr /><h2 id="ëŒ“ê¸€-ë“±ë¡-postsidreply-ì»¨íŠ¸ë¡¤ëŸ¬">ëŒ“ê¸€ ë“±ë¡ (/posts/{id}/reply) ì»¨íŠ¸ë¡¤ëŸ¬</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// PostController.java</span>
    <span class="nd">@PostMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/posts/{id}/reply"</span><span class="o">)</span>
    <span class="nd">@ResponseBody</span>
    <span class="kd">public</span> <span class="nc">ResponseEntity</span> <span class="nf">replyFormSubmit</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nd">@RequestBody</span> <span class="nc">NewReplyForm</span> <span class="n">newReplyForm</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postService</span><span class="o">.</span><span class="na">getVanillaPost</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">postService</span><span class="o">.</span><span class="na">createNewReply</span><span class="o">(</span><span class="n">modelMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">newReplyForm</span><span class="o">,</span> <span class="nc">Reply</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">post</span><span class="o">,</span> <span class="n">account</span><span class="o">);</span>
        <span class="k">return</span> <span class="nc">ResponseEntity</span><span class="o">.</span><span class="na">ok</span><span class="o">().</span><span class="na">build</span><span class="o">();</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>Ajax ë°©ì‹ìœ¼ë¡œ ìš”ì²­ì„ ë°›ì•„ ë¹„ë™ê¸°ì ìœ¼ë¡œ ì§„í–‰ì´ ë˜ì—ˆê¸°ì— @ResponseBodyë¥¼ ì´ìš©í•´ ResponseEntity ê°ì²´ë¥¼ ë‚´ë ¤ì£¼ì—ˆë‹¤. ì¼ì¢…ì˜ api í•¸ë“¤ëŸ¬ì—­í• ì„ í•œë‹¤ê³  ìƒê°í•˜ë©´ ëœë‹¤.</p><p><br /> ì´ í•¸ë“¤ëŸ¬ëŠ” ë·°ë‹¨ì—ì„œ ë¹„ë™ê¸°ì ìœ¼ë¡œ Postìš”ì²­ìœ¼ë¡œ ë„˜ì–´ì˜¨ newReplyFormì„ ë°›ì•„ Replyê°ì²´ë¡œ ë§¤í•‘ì„ ì§„í–‰í•˜ê³  ì´ë¥¼ ìƒì„±í•œë‹¤. ì´ë•Œ, Reply ì—”í‹°í‹°ëŠ” Postì™€ Accountê°ì²´ê°€ ë§¤í•‘ë˜ì–´ì•¼ í•œë‹¤.</p><p><br /> postì˜ ê²½ìš° <code class="language-plaintext highlighter-rouge">getVanillaPost</code>ë¼ëŠ” ë©”ì„œë“œë¥¼ í†µí•´ ê°€ì ¸ì˜¤ê³  ìˆë‹¤. ì´ë²ˆ Postë¥¼ ê°€ì ¸ì˜¬ë•Œ ìš°ë¦¬ëŠ” ì—°ê²°ëœ Accountë‚˜ descriptionê³¼ ê°™ì€ Lazyí”„ë¡œí¼í‹°ë“¤ì„ ê°€ì ¸ì˜¬ í•„ìš”ê°€ ì—†ë‹¤. ê·¸ëƒ¥ replyë¥¼ ë„£ì–´ì£¼ê¸°ë§Œ í•˜ë©´ ë˜ê¸° ë•Œë¬¸ì´ë‹¤.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre><td class="rouge-code"><pre><span class="c1">// PostService.java</span>
<span class="kd">public</span> <span class="nc">Post</span> <span class="nf">getVanillaPost</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">return</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">findPostById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
<span class="o">}</span>

<span class="c1">// PostRepository.java</span>
<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PostRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
    ì´ì „ ì½”ë“œë“¤
    */</span>

    <span class="nc">Post</span> <span class="nf">findPostById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
    <span class="c1">// ì–´ë– í•œ ì—°ê²°ê°ì²´ë„ ê¹¨ìš°ì§€ ì•Šì€ ìƒíƒœë¡œ ê°€ì ¸ì˜¨ë‹¤.</span>
    
    <span class="cm">/**
    ì´ì „ ì½”ë“œë“¤
    */</span>
<span class="o">}</span>
</pre></table></code></div></div><p>ë‹¤ìŒìœ¼ë¡œëŠ” postServiceì˜ <code class="language-plaintext highlighter-rouge">createNewReply</code>ë©”ì„œë“œë¥¼ ë³´ì. íŒŒë¼ë¯¸í„°ë¡œëŠ” Replyì™€ Post, Accountë¥¼ ë°›ê³ ìˆë‹¤.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="c1">// PostService.java</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">createNewReply</span><span class="o">(</span><span class="nc">Reply</span> <span class="n">reply</span><span class="o">,</span> <span class="nc">Post</span> <span class="n">post</span><span class="o">,</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
    <span class="nc">Account</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByEmail</span><span class="o">(</span><span class="n">account</span><span class="o">.</span><span class="na">getEmail</span><span class="o">());</span>
    <span class="c1">// detached ì‚´ë ¤ì˜¤ê¸°</span>

    <span class="n">reply</span><span class="o">.</span><span class="na">setAccount</span><span class="o">(</span><span class="n">writer</span><span class="o">);</span>
    <span class="n">post</span><span class="o">.</span><span class="na">addReply</span><span class="o">(</span><span class="n">reply</span><span class="o">);</span>
    <span class="n">writer</span><span class="o">.</span><span class="na">replyAdd</span><span class="o">();</span>
    <span class="n">replyRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">reply</span><span class="o">);</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>ìš°ë¦¬ëŠ” íŒŒë¼ë¯¸í„°ë¡œ @LoggedInUser ì–´ë…¸í…Œì´ì…˜ì´ ì ìš©ëœ Principalê°ì²´ë‚´ì˜ Accountë¥¼ ë°›ì•˜ë‹¤. ì´ ê°ì²´ëŠ” Detached ìƒíƒœì— í•´ë‹¹í•˜ë¯€ë¡œ ì´ë¥¼ ë‹¤ì‹œ Managedìƒíƒœë¡œ ì˜¬ë ¤ì£¼ì–´ì•¼ í•œë‹¤(4 ë¼ì¸). ì´ Replyì— ëŒ€í•œ ì‘ì„±ìì™€ post ì •ë³´ë¥¼ ì±„ì›Œì£¼ê³  ì €ì¥í•˜ë©´ ëœë‹¤.</p><blockquote><p>ì—¬ê¸°ì— writer.replyAdd()ë‚˜, post.addReply(reply) ê°™ì€ ë©”ì„œë“œê°€ ì¡´ì¬í•˜ëŠ”ë° ë‚˜ì¤‘ì— íšŒì› ì •ë³´ë¥¼ ë³´ì—¬ì¤„ ë•Œ ëŒ“ê¸€ìˆ˜ì™€ ê²Œì‹œê¸€ ìˆ˜ë¥¼ ë³´ì—¬ì£¼ê¸° ìœ„í•´ ìƒˆë¡œìš´ post/replyCount í”„ë¡œí¼í‹°ë¥¼ ë§Œë“¤ì–´ ë‘ì—ˆë‹¤. í›„ìì˜ ê²½ìš°ëŠ” ì–‘ë°©í–¥ ë§¤í•‘ì„ í•˜ë©° Post ë‚´ë¶€ í”„ë¡œí¼í‹°ì¸ replyCountë¥¼ 1 ë”í•´ì¤€ë‹¤.</p></blockquote><hr /><h2 id="ëŒ“ê¸€-ì‚­ì œ-postspostidreplyreplyiddelete-ì»¨íŠ¸ë¡¤ëŸ¬">ëŒ“ê¸€ ì‚­ì œ (/posts/{postId}/reply/{replyId}/delete) ì»¨íŠ¸ë¡¤ëŸ¬</h2><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// PostController.java</span>
    <span class="nd">@PostMapping</span><span class="o">(</span><span class="n">value</span> <span class="o">=</span> <span class="s">"/posts/{postId}/reply/{replyId}/delete"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">deleteReplySubmit</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"postId"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"replyId"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">replyId</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postService</span><span class="o">.</span><span class="na">getVanillaPost</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="nc">Reply</span> <span class="n">reply</span> <span class="o">=</span> <span class="n">replyRepository</span><span class="o">.</span><span class="na">findReplyById</span><span class="o">(</span><span class="n">replyId</span><span class="o">);</span>
        <span class="n">postService</span><span class="o">.</span><span class="na">deleteReply</span><span class="o">(</span><span class="n">reply</span><span class="o">,</span> <span class="n">post</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"redirect:/posts/"</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>
</pre></table></code></div></div><p>ì—­ì‹œ <code class="language-plaintext highlighter-rouge">getVanillaPost</code>ë©”ì„œë“œë¥¼ ì´ìš©í•˜ì—¬ ê²Œì‹œê¸€ì„ ê°€ì ¸ì™”ìœ¼ë©° replyê°ì²´ì™€ í•¨ê»˜ <code class="language-plaintext highlighter-rouge">postService.deleteReply</code>ì˜ íŒŒë¼ë¯¸í„°ë¡œ ë„˜ê²¨ì£¼ì—ˆë‹¤. ì´ ë©”ì„œë“œë¥¼ ì‚´í´ë³´ì.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">deleteReply</span><span class="o">(</span><span class="nc">Reply</span> <span class="n">reply</span><span class="o">,</span> <span class="nc">Post</span> <span class="n">post</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">post</span><span class="o">.</span><span class="na">removeReply</span><span class="o">();</span>
    <span class="n">reply</span><span class="o">.</span><span class="na">removeTrace</span><span class="o">();</span>
    <span class="n">replyRepository</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">reply</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>post ê°ì²´ë¡œ ë“¤ì–´ê°€ ì–‘ë°©í–¥ ë§¤í•‘ì„ ì œê±°í•˜ê³  removeTrace()ë©”ì„œë“œë¥¼ ì´ìš©í•˜ì—¬ Accountì™€ postê°ì²´ì˜ replyCountë¥¼ 1ì”© ë‚´ë ¤ì£¼ì—ˆë‹¤.</p><p><br /></p><p>ì´ë“¤ì´ ì œëŒ€ë¡œ ë™ì‘í•˜ëŠ”ì§€ í•œë²ˆ ì‚´í´ë³´ë„ë¡ í•˜ì.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/17.JPG" /></p><p>ì´ˆê¸°ì˜ í™”ë©´ì— í•´ë‹¹í•˜ê³ , ëŒ“ê¸€ì„ ë“±ë¡í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ ë‚˜íƒ€ë‚œë‹¤.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/18.JPG" /></p><p>ëŒ“ê¸€ì˜ ê¸€ì“´ì´ë©´ì„œ, ê²Œì‹œê¸€ì˜ ê¸€ì“´ì´ì— í•´ë‹¹í•˜ë¯€ë¡œ ìˆ˜ì •ê³¼ ì‚­ì œ ë²„íŠ¼ì´ ëª¨ë‘ ì—´ë ¤ìˆë‹¤. ë‹¤ë¥¸ ìœ ì €ë¡œ ë“¤ì–´ê°€ ëŒ“ê¸€ì„ ë‚¨ê²¨ë³´ì.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/19.JPG" /></p><p>ìì‹ ì´ ì“´ ëŒ“ê¸€ì—ë§Œ ì‚­ì œ ë²„íŠ¼ì´ ì—´ë ¤ìˆëŠ” ê²ƒì„ í™•ì¸í•´ ë³¼ ìˆ˜ ìˆì—ˆë‹¤.</p><hr /><h1 id="ë²„ê·¸-ìˆ˜ì •---post-ì—”í‹°í‹°ì™€-reply-ì—”í‹°í‹°ì˜-ì˜ì†ì„±-ì „ì´">ë²„ê·¸ ìˆ˜ì • - Post ì—”í‹°í‹°ì™€ Reply ì—”í‹°í‹°ì˜ ì˜ì†ì„± ì „ì´</h1><p>í•„ë“œ í…ŒìŠ¤íŠ¸ì¤‘ í•œê°€ì§€ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì—¬ ìˆ˜ì •í•˜ë ¤ê³  í•œë‹¤. (ì•„.. ì´ê±¸ ì™œ ìƒê° ì•ˆí•˜ê³  ìˆì—ˆì§€ ã… ã… ) ê²Œì‹œê¸€ì— ëŒ“ê¸€ì´ ë‹¬ë ¤ìˆì„ ê²½ìš°ì— ê¸€ì„ ì‚­ì œí•˜ë©´ ë‹¤ìŒê³¼ ê°™ì€ ì˜¤ë¥˜ê°€ ë°œìƒí•œë‹¤.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/20.JPG" /></p><p>í˜„ì¬ Post - Reply ê´€ê³„ì—ì„œ ì™¸ë˜í‚¤ë¥¼ ê°€ì§€ê³ ìˆëŠ” ìª½ì€ Replyì— í•´ë‹¹í•œë‹¤. ë™ì‹œì— ì—°ê´€ê´€ê³„ì˜ ì£¼ì¸ì— í•´ë‹¹í•œë‹¤. ì´ ë•Œ Postì—”í‹°í‹°ë¥¼ ì‚­ì œí•  ê²½ìš° RDBMSì˜ â€˜ì°¸ì¡° ë¬´ê²°ì„± ì›ì¹™â€™ì´ ê¹¨ì§€ê²Œ ë˜ì–´ ì´ëŸ¬í•œ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ëŠ” ê²ƒì´ë‹¤.</p><p><br /> ì´ ê²½ìš°ì—ëŠ”, ë¶€ëª¨ ë¦´ë ˆì´ì…˜(ì œê³µí•˜ëŠ” ìª½)ì´ Postì—”í‹°í‹°ì— í•´ë‹¹í•˜ë©° ìì‹ ë¦´ë ˆì´ì…˜(ì œê³µ ë°›ëŠ” ìª½)ì´ Replyì—”í‹°í‹°ì— í•´ë‹¹í•˜ë¯€ë¡œ ë¶€ëª¨ ë¦´ë ˆì´ì…˜ ì‚­ì œì‹œì— ì œì•½ì‚¬í•­ì´ ê±¸ë¦¬ëŠ” ê²ƒì´ë‹¤. ë”°ë¼ì„œ ë‹¤ìŒê³¼ ê°™ì€ ì˜µì…˜ì„ ì¶”ê°€í•´ì£¼ë©´ ëœë‹¤.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"post"</span><span class="o">)</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="kd">extends</span> <span class="nc">LocalDateTimeEntity</span> <span class="o">{</span>

    <span class="cm">/**
    ì´ì „ ì½”ë“œë“¤
    */</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"post"</span><span class="o">,</span> <span class="n">cascade</span> <span class="o">=</span> <span class="nc">CascadeType</span><span class="o">.</span><span class="na">ALL</span><span class="o">,</span> <span class="n">orphanRemoval</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Reply</span><span class="o">&gt;</span> <span class="n">replies</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

    <span class="cm">/**
    ì´ì „ ì½”ë“œë“¤
    */</span>
<span class="o">}</span>
</pre></table></code></div></div><p>ì°¸ì¡° ë¬´ê²°ì„± ì œì•½ì¡°ê±´ ì˜µì…˜ì¤‘ cascadeë¥¼ ì´ìš©í•˜ë©° ReplyëŠ” Postì™€ ìƒëª…ì£¼ê¸°ë¥¼ ê°™ì´í•˜ë„ë¡ í•œë‹¤. ê·¸ë¦¬ê³  <code class="language-plaintext highlighter-rouge">orphanRemoval = true</code> ì˜µì…˜ì„ ì£¼ì–´ ì°¸ì¡°ê°€ ëŠì–´ì§„ Replyë“¤ì€ ìë™ì‚­ì œë˜ê²Œë” í•œë‹¤(GC ëŒ€ìƒ)</p><blockquote><p>ì‚¬ì‹¤ ì—¬ê¸°ì„œ orphanRemoval ì˜µì…˜ì€ ì•ˆì£¼ì–´ë„ í¬ê²Œ ìƒê´€ì´ ì—†ë‹¤.</p></blockquote><p>ì´ì œ ê²Œì‹œê¸€ ìƒì„¸ë³´ê¸° êµ¬í˜„ ë° Replyì— ëŒ€í•œ ê¸°ëŠ¥ì€ ëª¨ë‘ êµ¬í˜„í•˜ì˜€ë‹¤. ë‹¤ìŒì—ëŠ” ê²Œì‹œê¸€ì„ ê²€ìƒ‰í•˜ëŠ” ì„œë¹„ìŠ¤ë¥¼ ë§Œë“¤ê³ , ê°€ì…ëœ ìœ ì € ëª©ë¡ì„ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ì„ ë§Œë“¤ì–´ë³´ì.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>Spring</a>, <a href='/categories/spring-project/'>spring_project</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/spring-mvc/" class="post-tag no-text-decoration" >spring mvc</a> <a href="/tags/springboot/" class="post-tag no-text-decoration" >springboot</a> <a href="/tags/springframework/" class="post-tag no-text-decoration" >springframework</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(5) - Vitriol&url=https://vitriol95.github.io/posts/mvcproject5/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(5) - Vitriol&u=https://vitriol95.github.io/posts/mvcproject5/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(5) - Vitriol&url=https://vitriol95.github.io/posts/mvcproject5/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/batchbase1/">ìŠ¤í”„ë§ ë°°ì¹˜ - 1 ìŠ¤í”„ë§ ë°°ì¹˜ë€?</a><li><a href="/posts/batchbase2/">ìŠ¤í”„ë§ ë°°ì¹˜ - 2 DB ìŠ¤í‚¤ë§ˆì— ëŒ€í•œ ì´í•´</a><li><a href="/posts/batchbase3/">ìŠ¤í”„ë§ ë°°ì¹˜ - 3 ë„ë©”ì¸ ëœ¯ì–´ë³´ê¸°(JOB)</a><li><a href="/posts/batchbase4/">ìŠ¤í”„ë§ ë°°ì¹˜ - 4 ë„ë©”ì¸ ëœ¯ì–´ë³´ê¸°(STEP)</a><li><a href="/posts/batchbase5/">ìŠ¤í”„ë§ ë°°ì¹˜ - 5 ì²­í¬ ì§€í–¥ ì²˜ë¦¬</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">ë°±ì¤€</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mvcproject1/"><div class="card-body"> <span class="timeago small" > Jun 1, 2021 <i class="unloaded">2021-06-01T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(1)</h3><div class="text-muted small"><p> í”„ë¡œì íŠ¸ ëª©í‘œ ìŠ¤í”„ë§ ë¶€íŠ¸ë¥¼ ì´ìš©í•˜ì—¬ ê°„ë‹¨í•œ ê²Œì‹œíŒ í˜ì´ì§€ë¥¼ ë§Œë“¤ì–´ ë³´ë ¤í•œë‹¤. ê·¸ë¦¬ê³  ì´ë¥¼ AWSì˜ EC2ë¥¼ ì´ìš©í•˜ì—¬ ì§ì ‘ ë¼ì´ë¸Œ ì„œë²„ì— ë„ì›Œë³´ëŠ” ê²ƒì„ ëª©í‘œë¡œ í•œë‹¤. ì´ˆê¸° ì„¤ì • JDK ë²„ì „ì€ 11ì— í•´ë‹¹í•˜ë©°, ìŠ¤í”„ë§ ë¶€íŠ¸ì˜ ë²„ì „ì€ 2.4.7ì„ ì‚¬ìš©í–ˆë‹¤. ë¶ˆëŸ¬ì˜¨ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì€ lombok, devtool, web, dataJpa ë§ˆì§€ë§‰ìœ¼ë¡œ í…œí”Œ...</p></div></div></a></div><div class="card"> <a href="/posts/mvcporject2/"><div class="card-body"> <span class="timeago small" > Jun 2, 2021 <i class="unloaded">2021-06-02T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(2)</h3><div class="text-muted small"><p> ì´ì „ ê¸€ ì´ì „ê¸€ ì—ì„œëŠ” Account í´ë˜ìŠ¤ë¥¼ ë§Œë“¤ê³  ì´ì— Spring Securityë¥¼ ì ìš©í•˜ì—¬ ë¡œê·¸ì¸ê³¼ íšŒì›ê°€ì…ì„ ì§„í–‰í•´ë³´ì•˜ë‹¤. ì´ë²ˆì‹œê°„ì—ëŠ” Accountì™€ ê´€ë ¨ëœ ê¸°ëŠ¥ë“¤ì„ ì¢€ ë” ë‹¤ë“¬ê³ , MockMvcë¥¼ ì´ìš©í•´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ ë³´ë ¤í•œë‹¤. Account ë‹¤ë“¬ê¸° íšŒì›ê°€ì… - ì¶”ê°€ 1 ì§€ë‚œ ì‹œê°„, íšŒì›ê°€ì…ì— ì¶”ê°€í•˜ì§€ ì•Šì€ ë¡œì§ì´ ì¡´ì¬í•œë‹¤. ë°”ë¡œ...</p></div></div></a></div><div class="card"> <a href="/posts/mvcproject3/"><div class="card-body"> <span class="timeago small" > Jun 3, 2021 <i class="unloaded">2021-06-03T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>ìŠ¤í”„ë§ mvc í”„ë¡œì íŠ¸ + AWS EC2ì— ë¹Œë“œê¹Œì§€(3)</h3><div class="text-muted small"><p> ì´ì „ ê¸€ ì´ì „ê¸€ ì—ì„œëŠ” Accountì™€ ê´€ë ¨ëœ ê¸°ëŠ¥ë“¤ì„ ì¢€ ë” ë‹¤ë“¬ê³ , MockMvcë¥¼ ì´ìš©í•´ í…ŒìŠ¤íŠ¸ë¥¼ ì§„í–‰í•´ ë³´ì•˜ë‹¤. ì´ë²ˆ ì‹œê°„ì—ëŠ” Accountì˜ ì •ë³´ ìˆ˜ì •ì„ êµ¬í˜„í•˜ê³  Postë¼ëŠ” ì—”í‹°í‹°ë¥¼ ì •ì˜í•´ë³´ë ¤í•œë‹¤. Account ì •ë³´ ìˆ˜ì • ì •ë³´ë³€ê²½ì— ëŒ€í•œ ê¸°ëŠ¥ì€ í”„ë¡ íŠ¸ë·°ì—ì„  ë‹¤ìŒê³¼ ê°™ì´ ìœ„ì¹˜í•´ ìˆìœ¼ë©° í´ë¦­ì‹œ URIëŠ” â€œ/settingsâ€ì— í•´ë‹¹í•œë‹¤...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/boj2042/" class="btn btn-outline-primary" prompt="Older"><p>ë°±ì¤€ 2042 êµ¬ê°„ í•© êµ¬í•˜ê¸° with Python</p></a> <a href="/posts/boj15686/" class="btn btn-outline-primary" prompt="Newer"><p>ë°±ì¤€ 15686 ì¹˜í‚¨ ë°°ë‹¬ with Python</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> Â© 2022 <a href="https://twitter.com/username">vitriol</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">ë°±ì¤€</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://vitriol95.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
