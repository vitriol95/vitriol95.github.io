<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3)" /><meta property="og:locale" content="ko" /><meta name="description" content="이전 글" /><meta property="og:description" content="이전 글" /><link rel="canonical" href="https://vitriol95.github.io/posts/mvcproject3/" /><meta property="og:url" content="https://vitriol95.github.io/posts/mvcproject3/" /><meta property="og:site_name" content="Vitriol" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-06-03T11:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3)" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="QsbP4NOwVkaE8CnHpYOl-qNGhxB9m1RbsrBEefA92ao" /> <script type="application/ld+json"> {"headline":"스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3)","dateModified":"2021-06-28T18:55:29+09:00","datePublished":"2021-06-03T11:00:00+09:00","description":"이전 글","url":"https://vitriol95.github.io/posts/mvcproject3/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://vitriol95.github.io/posts/mvcproject3/"},"@context":"https://schema.org"}</script><title>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3) | Vitriol</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Vitriol"><meta name="application-name" content="Vitriol"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WSY4XYN711"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WSY4XYN711'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Vitriol</a></div><div class="site-subtitle font-italic">기억을 적는 시간</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/vitriol95" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['vitriol951','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3)</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3)</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> vitriol </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Thu, Jun 3, 2021, 11:00 AM +0900" prep="on" > Jun 3, 2021 <i class="unloaded">2021-06-03T11:00:00+09:00</i> </span></div><div> <span> <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom" title="Mon, Jun 28, 2021, 6:55 PM +0900" prefix="Updated " > Jun 28, 2021 <i class="unloaded">2021-06-28T18:55:29+09:00</i> </span> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3857 words">21 min</span></div></div><div class="post-content"><h1 id="이전-글">이전 글</h1><p><a href="https://vitriol95.github.io/posts/mvcproject2/">이전글</a> 에서는 Account와 관련된 기능들을 좀 더 다듬고, MockMvc를 이용해 테스트를 진행해 보았다. 이번 시간에는 Account의 정보 수정을 구현하고 Post라는 엔티티를 정의해보려한다.</p><hr /><h1 id="account-정보-수정">Account 정보 수정</h1><p>정보변경에 대한 기능은 프론트뷰에선 다음과 같이 위치해 있으며 클릭시 URI는 “/settings”에 해당한다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/8.JPG" /></p><p>클릭하여 들어올 시, 뷰는 다음과 같이 구성된다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/9.JPG" /></p><p>닉네임과 소개글, 프로필 이미지를 변경할 수 있다. 프로필 이미지 변경에 대한 프로그램은 <a href="https://fengyuanchen.github.io/cropperjs/">Cropper</a>를 이용하여 구현하였다.</p><p><br /> 가장 먼저, “/settings” 뷰에는 회원가입과 마찬가지로 폼에 입력될 정보를 받을 객체가 필요하다. 이에 필자는 ‘ProfileForm’이라는 새로운 Dto 클래스를 정의하였다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.account.form</span><span class="o">;</span>

<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProfileForm</span> <span class="o">{</span>

    <span class="nd">@NotBlank</span>
    <span class="nd">@Length</span><span class="o">(</span><span class="n">min</span> <span class="o">=</span> <span class="mi">3</span><span class="o">,</span> <span class="n">max</span> <span class="o">=</span> <span class="mi">20</span><span class="o">)</span>
    <span class="nd">@Pattern</span><span class="o">(</span><span class="n">regexp</span> <span class="o">=</span> <span class="s">"^[ㄱ-ㅎ가-힣a-z0-9_-]{3,20}$"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">nickname</span><span class="o">;</span>

    <span class="nd">@Length</span><span class="o">(</span><span class="n">max</span> <span class="o">=</span> <span class="mi">35</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">bio</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">profileImage</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>이 역시 마찬가지로 javax.validation의 제약사항들을 적용해 주었다.</p></blockquote><p><br /> 앞서 회원가입의 경우, @InitBinder에 Validator를 추가해 준 것처럼 이 ProfileForm 또한 이미 존재하는 닉네임을 받으면 안되므로 이를 구현해주어야 한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.account.validator</span><span class="o">;</span>

<span class="nd">@Component</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ProfileFormValidator</span> <span class="kd">implements</span> <span class="nc">Validator</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">AccountRepository</span> <span class="n">accountRepository</span><span class="o">;</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supports</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">clazz</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="n">clazz</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="nc">ProfileForm</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">validate</span><span class="o">(</span><span class="nc">Object</span> <span class="n">target</span><span class="o">,</span> <span class="nc">Errors</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">ProfileForm</span> <span class="n">profileForm</span> <span class="o">=</span> <span class="o">(</span><span class="nc">ProfileForm</span><span class="o">)</span> <span class="n">target</span><span class="o">;</span>
        <span class="nc">Account</span> <span class="n">byNickname</span> <span class="o">=</span> <span class="n">accountRepository</span><span class="o">.</span><span class="na">findByNickname</span><span class="o">(</span><span class="n">profileForm</span><span class="o">.</span><span class="na">getNickname</span><span class="o">());</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">byNickname</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">errors</span><span class="o">.</span><span class="na">rejectValue</span><span class="o">(</span><span class="s">"nickname"</span><span class="o">,</span><span class="s">"wrong.value"</span><span class="o">,</span><span class="s">"해당 닉네임을 이미 사용중입니다."</span><span class="o">);</span>
        <span class="o">}</span>

    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>여기서는 SignUpForm Validator와 달리, 닉네임만 체크해주면 된다.</p></blockquote><p><br /> 이후, AccountController에 다음과 같은 핸들러들을 추가해 주어야한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.account</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountController</span> <span class="o">{</span>

    <span class="cm">/**
    이전 코드들
    */</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ProfileFormValidator</span> <span class="n">profileFormValidator</span><span class="o">;;</span>

    <span class="nd">@InitBinder</span><span class="o">(</span><span class="s">"profileForm"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">initBinder2</span><span class="o">(</span><span class="nc">WebDataBinder</span> <span class="n">webDataBinder</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">webDataBinder</span><span class="o">.</span><span class="na">addValidators</span><span class="o">(</span><span class="n">profileFormValidator</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/settings"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">updateProfileView</span><span class="o">(</span><span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">modelMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">account</span><span class="o">,</span> <span class="nc">ProfileForm</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="k">return</span> <span class="s">"account/settings"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/settings"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">updateProfile</span><span class="o">(</span><span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nd">@Valid</span> <span class="nd">@ModelAttribute</span> <span class="nc">ProfileForm</span> <span class="n">profileForm</span><span class="o">,</span> <span class="nc">Errors</span> <span class="n">errors</span><span class="o">,</span>
                                <span class="nc">Model</span> <span class="n">model</span><span class="o">,</span> <span class="nc">RedirectAttributes</span> <span class="n">redirectAttributes</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"account/settings"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">accountService</span><span class="o">.</span><span class="na">updateProfile</span><span class="o">(</span><span class="n">account</span><span class="o">,</span> <span class="n">profileForm</span><span class="o">);</span>
        <span class="n">redirectAttributes</span><span class="o">.</span><span class="na">addFlashAttribute</span><span class="o">(</span><span class="s">"message"</span><span class="o">,</span> <span class="s">"수정을 완료하였습니다"</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"redirect:"</span> <span class="o">+</span> <span class="s">"/settings"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>

</pre></table></code></div></div><blockquote><p>@GetMapping(“/settings”)에 대해서는 이미 적어둔 짧은 소개나 프로필 이미지가 존재할 수 있으므로 뷰에는 modelmapper를 통해 뿌려주었다.</p></blockquote><p><br /> post요청에 대해서는 회원가입을 처리하는 컨트롤러와 매우 유사하며 accountService로 들어가서 updateProfile이라는 메서드를 호출하게 된다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.account</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="nd">@Transactional</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AccountService</span> <span class="kd">implements</span> <span class="nc">UserDetailsService</span> <span class="o">{</span>

   <span class="cm">/**
   이전 코드들
   */</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updateProfile</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nc">ProfileForm</span> <span class="n">profileForm</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">modelMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">profileForm</span><span class="o">,</span> <span class="n">account</span><span class="o">);</span>
        <span class="n">accountRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>새롭게 modelmapper를 이용해 매핑을 한뒤, 얻어진 어카운트를 다시 save하면 된다. 이미 존재한 데이터이므로 merge에 해당하겠다.</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/10.JPG" /></p><p>기존 정보에서 닉네임과 프로필 이미지를 변경해 보았다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/11.JPG" /></p><hr /><h1 id="post-엔티티">Post 엔티티</h1><p>post의 경우 간단한 정보는 다음과 같다.</p><ol><li>제목, 짧은 요약, 본문, 공개여부(비밀글 여부)를 프로퍼티로 가진다.<li>글쓴이에 대한 정보가 필요하다. 이는 Account와의 관계성을 가진다.<blockquote><p>Account와 Post는 일대다 관계를 맺게 된다.</p></blockquote><li>댓글(Reply)과의 일대다 관계또한 존재한다.</ol><p><br /></p><p>이를 바탕으로 구현해본 Post객체는 다음과 같다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.post</span><span class="o">;</span>

<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"post"</span><span class="o">)</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="kd">extends</span> <span class="nc">LocalDateTimeEntity</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">introduction</span><span class="o">;</span>

    <span class="nd">@Lob</span>
    <span class="nd">@Basic</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">open</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setWriter</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">account</span> <span class="o">=</span> <span class="n">account</span><span class="o">;</span>
        <span class="n">account</span><span class="o">.</span><span class="na">getPosts</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>역시 슈퍼클래스인 LocalDateTimeEntity를 가지고있다. 특별한점은 22번째 라인인 본문의 fetch타입에 해당한다. 필자의 경우는 Lazy로 가져오게끔 설정을 해두었다. 게시글을 하나하나 볼때는 이를 가져와야 하지만, 나중에는 메인화면에 페이징을 하여 뿌릴 예정이므로 이때는 본문이 필요가 없다.</p></blockquote><blockquote><p>Account역시 일단은 Fetch로 잡아두었다. 필자는 관계성 필드의 경우 효율적인 쿼리를 위해서 일단은 모두 Lazy로 잡아두는 것을 선호한다.</p></blockquote><p><br /> 이후 Account와 Post의 매핑에 대해 생각해 보았다. Post의 경우에는 Account가 무조건 필요하지만, Account가 이러한 Post를 무조건 가져야 하는 이유는 없다. 하지만, 필자의 경우는 Account가 이러한 게시글 목록을 볼 수있게끔 하고싶기에 양방향 매핑을 진행하기로 하였다.</p><blockquote><p>이로인해 setWriter라는 양방향 매핑 메서드가 추가된 것이다.</p></blockquote><p><br /> 따라서 Account 클래스에는 다음이 추가된다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.account</span><span class="o">;</span>

<span class="nd">@Entity</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"account"</span><span class="o">)</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@EqualsAndHashCode</span><span class="o">(</span><span class="n">of</span> <span class="o">=</span> <span class="s">"id"</span><span class="o">,</span> <span class="n">callSuper</span> <span class="o">=</span> <span class="kc">false</span><span class="o">)</span>
<span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Account</span> <span class="kd">extends</span> <span class="nc">LocalDateTimeEntity</span> <span class="o">{</span>

    <span class="cm">/**
    이전 코드들
    */</span>

    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"account"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Set</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">&gt;</span> <span class="n">posts</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashSet</span><span class="o">&lt;&gt;();</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>양방향 매핑에 해당하므로 반드시 mappedBy를 설정해 주어야한다. 연관관계의 주인을 ‘다’ 쪽인 Post로 설정해 주었다.</p></blockquote><h2 id="post-작성하기">Post 작성하기</h2><p>이제 실제로 post를 작성해보자.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/12.JPG" /></p><p>이는 다음의 위치에 있으며, URI는 “/new-post”에 해당한다. 들어오게 되면 다음과 같은 뷰가 보이도록 구현해 두었다. 본문의 경우에는 <a href="https://summernote.org/">summerNote</a>를 이용하였다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/13.JPG" /></p><p><br /> 이에 들어올 내용을 받아줄 Dto 객체가 필요하다. 필자는 이를 “NewPostForm”이라는 클래스로 구현해 보았다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.post.form</span><span class="o">;</span>
<span class="nd">@Data</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">NewPostForm</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@NotBlank</span>
    <span class="nd">@Length</span><span class="o">(</span><span class="n">max</span> <span class="o">=</span> <span class="mi">50</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>

    <span class="nd">@NotBlank</span>
    <span class="nd">@Length</span><span class="o">(</span><span class="n">max</span> <span class="o">=</span> <span class="mi">100</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">introduction</span><span class="o">;</span>

    <span class="nd">@NotBlank</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">open</span><span class="o">;</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>id 프로퍼티를 가져온 이유는 나중에 글을 수정하려 할 때 용이하기 위해 같이 적어두었다.</p></blockquote><p><br /> 실제 폼이 가지고 있는 프로퍼티들과 대응되게 끔 구현을 해두었다. 체크박스가 클릭이 되면 <code class="language-plaintext highlighter-rouge">open = true</code>가 된다. 이제 실제 컨트롤러를 구현해보자.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.post</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostController</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PostService</span> <span class="n">postService</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ModelMapper</span> <span class="n">modelMapper</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/new-post"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">newPostForm</span><span class="o">(</span><span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>

        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="k">new</span> <span class="nc">NewPostForm</span><span class="o">());</span>
        <span class="k">return</span> <span class="s">"post/form"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/new-post"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">postFormSubmit</span><span class="o">(</span><span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">,</span> <span class="nd">@Valid</span> <span class="nc">NewPostForm</span> <span class="n">newPostForm</span><span class="o">,</span> <span class="nc">Errors</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"post/form"</span><span class="o">;</span>
        <span class="o">}</span>

        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postService</span><span class="o">.</span><span class="na">createNewPost</span><span class="o">(</span><span class="n">modelMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">newPostForm</span><span class="o">,</span> <span class="nc">Post</span><span class="o">.</span><span class="na">class</span><span class="o">),</span> <span class="n">account</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"redirect:/posts/"</span> <span class="o">+</span> <span class="n">post</span><span class="o">.</span><span class="na">getId</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>앞선 AccountController의 회원가입과 굉장히 유사하다.</p></blockquote><p>@PostMapping의 경우, 입력값이 정상이라면 postService의 createNewPost를 호출하게 된다. 서비스단을 살펴보자.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.post</span><span class="o">;</span>

<span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostService</span> <span class="o">{</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PostRepository</span> <span class="n">postRepository</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ModelMapper</span> <span class="n">modelMapper</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Post</span> <span class="nf">createNewPost</span><span class="o">(</span><span class="nc">Post</span> <span class="n">newPost</span><span class="o">,</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>

        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">save</span><span class="o">(</span><span class="n">newPost</span><span class="o">);</span>
        <span class="n">post</span><span class="o">.</span><span class="na">setWriter</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">post</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>기능은 정말 단순하다. 앞서 post엔티티에 정의해둔 setWriter라는 메서드를 사용하여 양방향 매핑또한 진행해주면 된다.</p></blockquote><p><br /> 이후, 컨트롤러에서는 글이 성공적으로 생성되었으면 /posts/id 로 리다이렉팅 시켜주고 있다. 이에 대한 뷰는 다음과 같다.</p><blockquote><p>사실 이렇게 id로 접근하는 방식은 좋지않다.</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/14.JPG" /></p><p>네가지의 블록으로 이루어져 있다.</p><ol><li>맨 위 블록에 제목과 생성 / 수정날짜가 있으며 만약 작성자일 경우 수정과 삭제버튼이 노출된다.<li>두번째 블록에는 작성자 항목에 해당한다.<li>세번째 블록이 본문에 해당한다.<li>네번째 블록은 Reply들이 위치할 곳에 해당한다.</ol><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.post</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostController</span> <span class="o">{</span>

    <span class="cm">/**
    이전 코드들
    */</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">PostRepository</span> <span class="n">postRepository</span><span class="o">;</span>

    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/posts/{id}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">postView</span><span class="o">(</span><span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">findPostWithUserAndRepliesById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">post</span><span class="o">.</span><span class="na">isOpen</span><span class="o">())</span> <span class="o">{</span>
            <span class="c1">// TODO 에러페이지로 돌리기</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="s">"post"</span><span class="o">,</span> <span class="n">post</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"post/view"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>상세 글보기의 컨트롤러에 해당한다. 여기서 주목할 부분은 postRepository의 <code class="language-plaintext highlighter-rouge">findPostWithUserAndRepliesById(id)</code>라는 메서드를 호출하게 된다. 이를 통해 post객체를 가져오게 되는데, 이때 post와 연관된 엔티티, 즉 글쓴이(Account)와 코멘트(Reply)를 모두 가져와야한다. 아직 Reply엔티티를 만들지 않았으므로 이 메서드는 나중에 더 수정하도록 하겠다.</p></blockquote><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.post</span><span class="o">;</span>

<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PostRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="c1">// TODO: Reply 까지 Fetch 해야함</span>
    <span class="nc">Post</span> <span class="nf">findPostWithUserAndRepliesById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>

<span class="o">}</span>
</pre></table></code></div></div><p><br /> 그리고 이 post 뷰 구현부는 다음과 같다.</p><div class="language-html highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
</pre><td class="rouge-code"><pre>
<span class="nt">&lt;main</span> <span class="na">role=</span><span class="s">"main"</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-flex align-items-center p-3 my-3 bg-purple rounded shadow-sm"</span> 
    <span class="na">style=</span><span class="s">"justify-content: space-between"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"lh-200"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;h3</span> <span class="na">class=</span><span class="s">"mb-0 lh-200"</span> <span class="na">th:text=</span><span class="s">"${post.title}"</span><span class="nt">&gt;</span>Bootstrap<span class="nt">&lt;/h3&gt;</span>
            <span class="nt">&lt;small</span> <span class="na">th:text=</span><span class="s">"${#temporals.format(post.modifiedDate,'yyyy-MM-dd HH:mm')}"</span><span class="nt">&gt;</span>localdate<span class="nt">&lt;/small&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"lh-200"</span> <span class="na">th:if=</span><span class="s">"${post.isWriter(#authentication.principal)}"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-inline"</span> <span class="na">th:if=</span><span class="s">"${post.isWriter(#authentication.principal)}"</span> <span class="na">action=</span><span class="s">"#"</span> 
            <span class="na">th:action=</span><span class="s">"@{'/posts/' + ${post.getId()} + '/update'}"</span> <span class="na">method=</span><span class="s">"get"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-outline-primary"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>수정<span class="nt">&lt;/button&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
            <span class="nt">&lt;form</span> <span class="na">class=</span><span class="s">"form-inline"</span> <span class="na">th:if=</span><span class="s">"${post.isWriter(#authentication.principal)}"</span> <span class="na">action=</span><span class="s">"#"</span> 
            <span class="na">th:action=</span><span class="s">"@{'/posts/' + ${post.getId()} + '/delete'}"</span> <span class="na">method=</span><span class="s">"post"</span> <span class="na">novalidate</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"form-group"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;button</span> <span class="na">class=</span><span class="s">"btn btn-outline-danger"</span> <span class="na">type=</span><span class="s">"submit"</span><span class="nt">&gt;</span>삭제<span class="nt">&lt;/button&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
            <span class="nt">&lt;/form&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-flex align-items-center p-3 my-3 bg-purple rounded shadow-sm"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"lh-100"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;svg</span> <span class="na">th:if=</span><span class="s">"${#strings.isEmpty(post.account?.profileImage)}"</span> <span class="na">data-jdenticon-value=</span><span class="s">"user111"</span> 
            <span class="na">th:data-jdenticon-value=</span><span class="s">"${post.account.email}"</span> <span class="na">width=</span><span class="s">"32"</span> <span class="na">height=</span><span class="s">"32"</span> <span class="na">class=</span><span class="s">"rounded boarder bg-light"</span><span class="nt">&gt;&lt;/svg&gt;</span>
            <span class="nt">&lt;img</span> <span class="na">th:if=</span><span class="s">"${!#strings.isEmpty(post.account?.profileImage)}"</span> <span class="na">th:src=</span><span class="s">"${post.account.profileImage}"</span>
                    <span class="na">width=</span><span class="s">"32"</span> <span class="na">height=</span><span class="s">"32"</span> <span class="na">class=</span><span class="s">"rounded boarder bg-light"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"lh-100 h6 mb-0"</span> <span class="na">th:text=</span><span class="s">"${post.account.nickname}"</span><span class="nt">&gt;&lt;/span&gt;</span>
        <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"my-3 p-3 bg-white rounded shadow-sm"</span> <span class="na">th:utext=</span><span class="s">"${post.description}"</span><span class="nt">&gt;</span>

    <span class="nt">&lt;/div&gt;</span>

    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"my-3 p-3 bg-white rounded shadow-sm"</span><span class="nt">&gt;</span>
        <span class="nt">&lt;h6</span> <span class="na">class=</span><span class="s">"border-bottom border-gray pb-2 mb-0"</span><span class="nt">&gt;&lt;strong&gt;</span>코멘트<span class="nt">&lt;/strong&gt;&lt;/h6&gt;</span>
        <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"media text-muted pt-3"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;svg</span> <span class="na">class=</span><span class="s">"bd-placeholder-img mr-2 rounded"</span> <span class="na">width=</span><span class="s">"32"</span> <span class="na">height=</span><span class="s">"32"</span> <span class="na">xmlns=</span><span class="s">"http://www.w3.org/2000/svg"</span> 
            <span class="na">role=</span><span class="s">"img"</span> <span class="na">aria-label=</span><span class="s">"Placeholder: 32x32"</span> <span class="na">preserveAspectRatio=</span><span class="s">"xMidYMid slice"</span> <span class="na">focusable=</span><span class="s">"false"</span><span class="nt">&gt;&lt;title&gt;</span>Placeholder<span class="nt">&lt;/title&gt;</span>
            <span class="nt">&lt;rect</span> <span class="na">width=</span><span class="s">"100%"</span> <span class="na">height=</span><span class="s">"100%"</span> <span class="na">fill=</span><span class="s">"#007bff"</span><span class="nt">&gt;&lt;/rect&gt;&lt;</span>
                <span class="nt">text</span> <span class="na">x=</span><span class="s">"50%"</span> <span class="na">y=</span><span class="s">"50%"</span> <span class="na">fill=</span><span class="s">"#007bff"</span> <span class="na">dy=</span><span class="s">".3em"</span><span class="nt">&gt;</span>32x32<span class="nt">&lt;/text&gt;&lt;/svg&gt;</span>

            <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"media-body pb-3 mb-0 small lh-125 border-bottom border-gray"</span><span class="nt">&gt;</span>
                <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"d-flex justify-content-between align-items-center w-100"</span><span class="nt">&gt;</span>
                    <span class="nt">&lt;strong</span> <span class="na">class=</span><span class="s">"text-gray-dark"</span><span class="nt">&gt;</span>Full Name<span class="nt">&lt;/strong&gt;</span>
                    <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>Follow<span class="nt">&lt;/a&gt;</span>
                <span class="nt">&lt;/div&gt;</span>
                <span class="nt">&lt;span</span> <span class="na">class=</span><span class="s">"d-block"</span><span class="nt">&gt;</span>@username<span class="nt">&lt;/span&gt;</span>
            <span class="nt">&lt;/div&gt;</span>
        <span class="nt">&lt;/div&gt;</span>

        <span class="nt">&lt;small</span> <span class="na">class=</span><span class="s">"d-block text-right mt-3"</span><span class="nt">&gt;</span>
            <span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"#"</span><span class="nt">&gt;</span>All suggestions<span class="nt">&lt;/a&gt;</span>
        <span class="nt">&lt;/small&gt;</span>
    <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/main&gt;</span>
</pre></table></code></div></div><p>가장먼저 9번째 줄부터 시작하는 div 컴포넌트를 보자. 이 컴포넌트는 수정과 삭제 버튼을 담고 있는 것으로 글을 보고 있는 사용자가 실제 글쓴이인지 프론트 단에서 확인하는 과정이 필요하다. 따라서 이는 post내의 isWriter라는 함수를 사용하여 판별하려 하였다. 이 함수의 인자로는 principal에 해당하는 UserAccount가 들어오게 될 것이다.</p><p><br /> 따라서 Post 클래스의 다음의 메서드를 추가해주어야 한다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre><td class="rouge-code"><pre><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"post"</span><span class="o">)</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="kd">extends</span> <span class="nc">LocalDateTimeEntity</span> <span class="o">{</span>

    <span class="cm">/**
    이전 코드들
    */</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isWriter</span><span class="o">(</span><span class="nc">UserAccount</span> <span class="n">userAccount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">account</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">userAccount</span><span class="o">.</span><span class="na">getAccount</span><span class="o">());</span>
    <span class="o">}</span>

<span class="o">}</span>
</pre></table></code></div></div><p>이렇게 되면, thymealeaf 템플릿을 거쳐 이 메서드를 프론트단에서 이용할 수 있게 된다.</p><h2 id="post의-수정-및-삭제-기능">Post의 수정 및 삭제 기능</h2><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/mvcproject/15.JPG" /></p><p>‘수정’과 ‘삭제’버튼을 눌러 게시글을 수정하거나 삭제할 수 있도록 기능 구현을 해볼 예정이다. 수정의 경우에는 <code class="language-plaintext highlighter-rouge">/posts/게시글id/update</code> 페이지를 get 방식으로 가져오며 삭제의 경우에는 <code class="language-plaintext highlighter-rouge">/posts/게시글id/delete</code>로 post요청을 보낸다.</p><blockquote><p>게시글 뷰 html코드의 11번째, 17번째 라인처럼 inline - form으로 구현했다.</p></blockquote><p><br /> 이들의 컨트롤러를 살펴보자.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.post</span><span class="o">;</span>

<span class="nd">@Controller</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostController</span> <span class="o">{</span>

    <span class="cm">/**
    */</span>
    
    <span class="nd">@GetMapping</span><span class="o">(</span><span class="s">"/posts/{id}/update"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">updatePostFormView</span><span class="o">(</span><span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postService</span><span class="o">.</span><span class="na">getPostToUpdate</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">account</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
        <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">modelMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">post</span><span class="o">,</span> <span class="nc">NewPostForm</span><span class="o">.</span><span class="na">class</span><span class="o">));</span>
        <span class="k">return</span> <span class="s">"post/update"</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/posts/{id}/update"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">updatePostFromSubmit</span><span class="o">(</span><span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nd">@Valid</span> <span class="nc">NewPostForm</span> <span class="n">newPostForm</span><span class="o">,</span> <span class="nc">Model</span> <span class="n">model</span><span class="o">,</span> <span class="nc">Errors</span> <span class="n">errors</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postService</span><span class="o">.</span><span class="na">getPostToUpdate</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">account</span><span class="o">);</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">errors</span><span class="o">.</span><span class="na">hasErrors</span><span class="o">())</span> <span class="o">{</span>
            <span class="n">model</span><span class="o">.</span><span class="na">addAttribute</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
            <span class="k">return</span> <span class="s">"posts/"</span> <span class="o">+</span> <span class="n">id</span> <span class="o">+</span> <span class="s">"/update"</span><span class="o">;</span>
        <span class="o">}</span>
        <span class="n">postService</span><span class="o">.</span><span class="na">updatePost</span><span class="o">(</span><span class="n">post</span><span class="o">,</span> <span class="n">newPostForm</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"redirect:/posts/"</span> <span class="o">+</span> <span class="n">id</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="nd">@PostMapping</span><span class="o">(</span><span class="s">"/posts/{id}/delete"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">deletePostSubmit</span><span class="o">(</span><span class="nd">@LoggedInUser</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nd">@PathVariable</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postService</span><span class="o">.</span><span class="na">getPostToUpdate</span><span class="o">(</span><span class="n">id</span><span class="o">,</span> <span class="n">account</span><span class="o">);</span>
        <span class="n">postService</span><span class="o">.</span><span class="na">deletePost</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"redirect:/"</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>수정에 해당하는 URI <code class="language-plaintext highlighter-rouge">/posts/id/update</code>로 향하는 @GetMapping과 @PostMapping은 새로운 포스트를 작성할때와 매우 비슷하다. 이때 새로운 Dto를 만드는 것보다는 기존의 NewPostForm클래스를 재사용해주었다.</p><p><br /> 18번째 라인부터 시작하는 updatePostFormSubmit 메서드는 실제 post요청이 들어올 때 이를 수정하는 핸들러에 해당한다. 가장 먼저 postService의 getPostToUpdate를 호출하고 있다. PostService의 수정 부분을 살펴보자.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre><td class="rouge-code"><pre><span class="nd">@Service</span>
<span class="nd">@Transactional</span>
<span class="nd">@RequiredArgsConstructor</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">PostService</span> <span class="o">{</span>

    <span class="cm">/**
    이전 코드들
    */</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="nc">ModelMapper</span> <span class="n">modelMapper</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nc">Post</span> <span class="nf">getPostToUpdate</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">,</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">Post</span> <span class="n">post</span> <span class="o">=</span> <span class="n">postRepository</span><span class="o">.</span><span class="na">findPostWithAccountById</span><span class="o">(</span><span class="n">id</span><span class="o">);</span>
        <span class="n">validateWriter</span><span class="o">(</span><span class="n">account</span><span class="o">,</span> <span class="n">post</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">post</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">private</span> <span class="kt">void</span> <span class="nf">validateWriter</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">,</span> <span class="nc">Post</span> <span class="n">post</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">if</span> <span class="o">(!</span><span class="n">post</span><span class="o">.</span><span class="na">isWriter</span><span class="o">(</span><span class="n">account</span><span class="o">))</span> <span class="o">{</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">AccessDeniedException</span><span class="o">(</span><span class="s">"작성자가 아닙니다."</span><span class="o">);</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">updatePost</span><span class="o">(</span><span class="nc">Post</span> <span class="n">post</span><span class="o">,</span> <span class="nc">NewPostForm</span> <span class="n">newPostForm</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">modelMapper</span><span class="o">.</span><span class="na">map</span><span class="o">(</span><span class="n">newPostForm</span><span class="o">,</span> <span class="n">post</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">deletePost</span><span class="o">(</span><span class="nc">Post</span> <span class="n">post</span><span class="o">)</span> <span class="o">{</span>
        <span class="n">postRepository</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="n">post</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</pre></table></code></div></div><p>마지막 두개의 메서는 실제 트랜잭션안에서 글의 수정과 삭제를 진행해주고 있다. 제일 첫 메서드의 getPostToUpdate메서드의 경우에는 다음과 같은 로직이 진행된다.</p><ol><li>현재 계정이 그 글의 작성자인지 확인한다. (validateWriter 메서드)<blockquote><p>사실 이것은 프론트뷰에서도 체크를 해주고 있지만, 더블체킹을 하기 위해 백엔드 부분에서도 구현해주었다.</p></blockquote><li>작성자가 아니라면 AccessDeniedException을 던진다.<li>작성자가 맞다면 postRepository의 findPostWithAccountById를 불러온다. 이 메서드는 다음과 같다.</ol><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="kn">package</span> <span class="nn">vitriol.mvcservice.modules.post</span><span class="o">;</span>

<span class="nd">@Transactional</span><span class="o">(</span><span class="n">readOnly</span> <span class="o">=</span> <span class="kc">true</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">interface</span> <span class="nc">PostRepository</span> <span class="kd">extends</span> <span class="nc">JpaRepository</span><span class="o">&lt;</span><span class="nc">Post</span><span class="o">,</span> <span class="nc">Long</span><span class="o">&gt;</span> <span class="o">{</span>

    <span class="cm">/**
    이전 코드들
    */</span>

    <span class="nd">@EntityGraph</span><span class="o">(</span><span class="n">attributePaths</span> <span class="o">=</span> <span class="s">"account"</span><span class="o">,</span><span class="n">type</span> <span class="o">=</span> <span class="nc">EntityGraph</span><span class="o">.</span><span class="na">EntityGraphType</span><span class="o">.</span><span class="na">LOAD</span><span class="o">)</span>
    <span class="nc">Post</span> <span class="nf">findPostWithAccountById</span><span class="o">(</span><span class="nc">Long</span> <span class="n">id</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><blockquote><p>@EntityGraph를 해주어 id로 query를 진행할때 account까지 조인해서 가져오게 된다.</p></blockquote><p><br /> 그리고 이전의 post의 isWriter함수는 UserAccount에 대해서만 진행을 했지만, account에 대해서도 가능해야하므로 이를 오버로딩하였다.</p><div class="language-java highlighter-rouge"><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="nd">@Getter</span>
<span class="nd">@Setter</span>
<span class="nd">@Table</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"post"</span><span class="o">)</span>
<span class="nd">@NoArgsConstructor</span>
<span class="nd">@AllArgsConstructor</span>
<span class="nd">@Entity</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Post</span> <span class="kd">extends</span> <span class="nc">LocalDateTimeEntity</span> <span class="o">{</span>

    <span class="nd">@Id</span>
    <span class="nd">@GeneratedValue</span><span class="o">(</span><span class="n">strategy</span> <span class="o">=</span> <span class="nc">GenerationType</span><span class="o">.</span><span class="na">IDENTITY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">id</span><span class="o">;</span>

    <span class="nd">@ManyToOne</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Account</span> <span class="n">account</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">title</span><span class="o">;</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">introduction</span><span class="o">;</span>

    <span class="nd">@Lob</span>
    <span class="nd">@Basic</span><span class="o">(</span><span class="n">fetch</span> <span class="o">=</span> <span class="nc">FetchType</span><span class="o">.</span><span class="na">LAZY</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">description</span><span class="o">;</span>

    <span class="kd">private</span> <span class="kt">boolean</span> <span class="n">open</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setWriter</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">account</span> <span class="o">=</span> <span class="n">account</span><span class="o">;</span>
        <span class="n">account</span><span class="o">.</span><span class="na">getPosts</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="k">this</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isWriter</span><span class="o">(</span><span class="nc">UserAccount</span> <span class="n">userAccount</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">account</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">userAccount</span><span class="o">.</span><span class="na">getAccount</span><span class="o">());</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">isWriter</span><span class="o">(</span><span class="nc">Account</span> <span class="n">account</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">account</span><span class="o">.</span><span class="na">equals</span><span class="o">(</span><span class="n">account</span><span class="o">);</span>
    <span class="o">}</span> <span class="c1">// 추가된 메서드(isWriter 오버로딩)</span>
<span class="o">}</span>
</pre></table></code></div></div><p>다음 시간에는 postController에 대한 테스트를 진행해보며 필요한 부분이 있다면 보충하고, Reply엔티티 또한 만들어보려 한다.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/spring/'>Spring</a>, <a href='/categories/spring-project/'>spring_project</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/spring/" class="post-tag no-text-decoration" >spring</a> <a href="/tags/spring-mvc/" class="post-tag no-text-decoration" >spring mvc</a> <a href="/tags/springboot/" class="post-tag no-text-decoration" >springboot</a> <a href="/tags/springframework/" class="post-tag no-text-decoration" >springframework</a> <a href="/tags/java/" class="post-tag no-text-decoration" >java</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3) - Vitriol&url=https://vitriol95.github.io/posts/mvcproject3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3) - Vitriol&u=https://vitriol95.github.io/posts/mvcproject3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=스프링 mvc 프로젝트 + AWS EC2에 빌드까지(3) - Vitriol&url=https://vitriol95.github.io/posts/mvcproject3/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/batchbase1/">스프링 배치 - 1 스프링 배치란?</a><li><a href="/posts/batchbase2/">스프링 배치 - 2 DB 스키마에 대한 이해</a><li><a href="/posts/batchbase3/">스프링 배치 - 3 도메인 뜯어보기(JOB)</a><li><a href="/posts/batchbase4/">스프링 배치 - 4 도메인 뜯어보기(STEP)</a><li><a href="/posts/batchbase5/">스프링 배치 - 5 청크 지향 처리</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">백준</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mvcproject1/"><div class="card-body"> <span class="timeago small" > Jun 1, 2021 <i class="unloaded">2021-06-01T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(1)</h3><div class="text-muted small"><p> 프로젝트 목표 스프링 부트를 이용하여 간단한 게시판 페이지를 만들어 보려한다. 그리고 이를 AWS의 EC2를 이용하여 직접 라이브 서버에 띄워보는 것을 목표로 한다. 초기 설정 JDK 버전은 11에 해당하며, 스프링 부트의 버전은 2.4.7을 사용했다. 불러온 라이브러리들은 lombok, devtool, web, dataJpa 마지막으로 템플...</p></div></div></a></div><div class="card"> <a href="/posts/mvcporject2/"><div class="card-body"> <span class="timeago small" > Jun 2, 2021 <i class="unloaded">2021-06-02T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(2)</h3><div class="text-muted small"><p> 이전 글 이전글 에서는 Account 클래스를 만들고 이에 Spring Security를 적용하여 로그인과 회원가입을 진행해보았다. 이번시간에는 Account와 관련된 기능들을 좀 더 다듬고, MockMvc를 이용해 테스트를 진행해 보려한다. Account 다듬기 회원가입 - 추가 1 지난 시간, 회원가입에 추가하지 않은 로직이 존재한다. 바로...</p></div></div></a></div><div class="card"> <a href="/posts/mvcproject4/"><div class="card-body"> <span class="timeago small" > Jun 4, 2021 <i class="unloaded">2021-06-04T11:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>스프링 mvc 프로젝트 + AWS EC2에 빌드까지(4)</h3><div class="text-muted small"><p> 이전 글 이전글 에서는 Post 엔티티를 정의하고 이를 등록, 수정, 삭제하는 과정을 진행하였다. 이번 시간에는 저번 시간에 이어 부족한 부분들을 채워보고, 테스트를 진행한뒤, Reply엔티티까지 만들어 보겠다. Account 정보 수정관련 추가 이전 닉네임을 변경할 때, ProfileFormValidator 라는 클래스의 validate (...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/boj14500/" class="btn btn-outline-primary" prompt="Older"><p>백준 14500 테트로미노 with Python</p></a> <a href="/posts/boj14499/" class="btn btn-outline-primary" prompt="Newer"><p>백준 14499 주사위 굴리기 with Python</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">vitriol</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">백준</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://vitriol95.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
