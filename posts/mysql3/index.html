<!DOCTYPE html><html lang="ko" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="DB의 트랜잭션 (3) 트랜잭션의 격리성, LOCK 두번째" /><meta property="og:locale" content="ko" /><meta name="description" content="이전시간" /><meta property="og:description" content="이전시간" /><link rel="canonical" href="https://vitriol95.github.io/posts/mysql3/" /><meta property="og:url" content="https://vitriol95.github.io/posts/mysql3/" /><meta property="og:site_name" content="Vitriol" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2021-10-03T14:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="DB의 트랜잭션 (3) 트랜잭션의 격리성, LOCK 두번째" /><meta name="twitter:site" content="@" /><meta name="google-site-verification" content="QsbP4NOwVkaE8CnHpYOl-qNGhxB9m1RbsrBEefA92ao" /> <script type="application/ld+json"> {"headline":"DB의 트랜잭션 (3) 트랜잭션의 격리성, LOCK 두번째","dateModified":"2021-10-03T14:00:00+09:00","datePublished":"2021-10-03T14:00:00+09:00","description":"이전시간","url":"https://vitriol95.github.io/posts/mysql3/","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://vitriol95.github.io/posts/mysql3/"},"@context":"https://schema.org"}</script><title>DB의 트랜잭션 (3) 트랜잭션의 격리성, LOCK 두번째 | Vitriol</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Vitriol"><meta name="application-name" content="Vitriol"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://fonts.gstatic.com"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="preconnect" href="https://cdn.jsdelivr.net"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1.1.0/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4/dist/js/bootstrap.min.js"></script> <script async src="https://cdn.jsdelivr.net/combine/npm/lozad/dist/lozad.min.js,npm/magnific-popup@1/dist/jquery.magnific-popup.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-WSY4XYN711"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-WSY4XYN711'); }); </script><body data-spy="scroll" data-target="#toc"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src="/assets/img/profile.png" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Vitriol</a></div><div class="site-subtitle font-italic">기억을 적는 시간</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center"> <a href="https://github.com/vitriol95" aria-label="github" class="order-3" target="_blank" rel="noopener"> <i class="fab fa-github-alt"></i> </a> <a href="https://twitter.com/" aria-label="twitter" class="order-4" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['vitriol951','gmail.com'].join('@')" aria-label="email" class="order-5" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" class="order-6" > <i class="fas fa-rss"></i> </a> <span class="icon-border order-2"></span> <span id="mode-toggle-wrapper" class="order-1"> <i class="mode-toggle fas fa-adjust"></i> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } var self = this; /* always follow the system prefers */ this.sysDarkPrefers.addListener(function() { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.updateMermaid(); }); } /* constructor() */ setDark() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_KEY); sessionStorage.removeItem(ModeToggle.MODE_KEY); } get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode == ModeToggle.DARK_MODE; } get isLightMode() { return this.mode == ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer) ) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } updateMermaid() { if (typeof mermaid !== "undefined") { let expectedTheme = (this.modeStatus === ModeToggle.DARK_MODE? "dark" : "default"); let config = { theme: expectedTheme }; /* re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function() { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.updateMermaid(); } /* flipMode() */ } /* ModeToggle */ let toggle = new ModeToggle(); $(".mode-toggle").click(function() { toggle.flipMode(); }); </script> </span></div></div><div id="topbar-wrapper" class="row justify-content-center topbar-down"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Posts </a> </span> <span>DB의 트랜잭션 (3) 트랜잭션의 격리성, LOCK 두번째</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> <i class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="post-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>DB의 트랜잭션 (3) 트랜잭션의 격리성, LOCK 두번째</h1><div class="post-meta text-muted d-flex flex-column"><div> <span class="semi-bold"> vitriol </span> <span class="timeago " data-toggle="tooltip" data-placement="bottom" title="Sun, Oct 3, 2021, 2:00 PM +0900" prep="on" > Oct 3, 2021 <i class="unloaded">2021-10-03T14:00:00+09:00</i> </span></div><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2633 words">14 min</span></div></div><div class="post-content"><h1 id="이전시간">이전시간</h1><p>이전시간에 대한 이야기는 시나리오 2번의 상황에 해당했다.</p><ol><li>트랜잭션 A,B 모두 읽기만 진행할 때<li><strong>트랜잭션 A,B 모두 쓰기를 진행할 때</strong><li>트랜잭션 A는 읽기만 진행, B는 쓰기를 진행</ol><p>파생한 문제점에서 <code class="language-plaintext highlighter-rouge">갱신 손실문제</code> 를 Lock의 개념으로 해결해 보았다.</p><h2 id="트랜잭션-격리-수준">트랜잭션 격리 수준</h2><p>이제 시나리오 3으로 들어와보자. 2에서 처럼 <code class="language-plaintext highlighter-rouge">갱신 손실문제</code> 처럼 심각한 문제는 발생하지 않지만 <code class="language-plaintext highlighter-rouge">트랜잭션 격리성으로 나타날 수 있는 문제점</code> 들이 발생한다. 그리고 이들은 아래와 같은 하위 문제들로 나뉜다.</p><ul><li>오손 읽기(dirty read)<li>반복 불가능 읽기(non-repeatable read)<li>유령 데이터 읽기(phantom read)</ul><h3 id="dirty-read">Dirty Read</h3><p>읽기 작업이 진행중인 T1이 쓰기 작업을 하는 T2가 작업한 중간 데이터를 읽어 생기는 문제이다. 작업중인 T2가 어떤 이유로 Rollback할 경우, T1은 무효가 된 데이터를 읽게 되고 잘못된 결과를 도출한다.</p><blockquote><p>역시 시나리오로 살펴보겠다. 원래 1번 유저의 age는 10이다.</p></blockquote><div class="table-wrapper"><table><thead><tr><th>트랜잭션 1<th>트랜잭션 2<th>번호<tbody><tr><td>SET TRANSACTION ISOLATION LEVEL READ <br /> UNCOMMITTED <br /> START TRANSACTION <br /> SELECT * FROM Users WHERE id=1<td> <td>1<tr><td> <td>SET TRANSACTION ISOLATION LEVEL READ <br /> COMMITTED <br /> START TRANSACTION <br /> UPDATE Users SET age=21<td>2<tr><td>SELECT * FROM Users WHERE id=1<td> <td>3<tr><td> <td>ROLLBACK<td>4<tr><td>SELECT * FROM Users WHERE id=1<td> <td>5</table></div><p>1번에서는 age =10 이라고 읽고 있지만 3번과정에서는 age = 21이라고 읽게 된다.</p><blockquote><p>롤백이후 5번에서는 다시 age = 10으로 읽어온다.</p></blockquote><p>그림으로 본다면 이러한 예시가 있다.</p><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sql/1.JPG" /></p><p>T2는 잘못된 값을 가지고 로직을 처리할 위험이 있는 것이다.</p><h3 id="non-repeatable-read">Non-repeatable read</h3><p>T1이 데이터를 읽고 작업하던 중, T2가 데이터를 변경하였다. T1이 이렇게 변경된 데이터를 보고 다시 한번 작업을 진행하였다. Dirty read와 달리 T2가 정상적으로 종료하여 COMMIT을 했기에, 틀린 데이터는 아니지만 T1입장에서는 의도치 않은 결과를 도출한다.</p><div class="table-wrapper"><table><thead><tr><th>트랜잭션 1<th>트랜잭션 2<th>번호<tbody><tr><td>SET TRANSACTION ISOLATION LEVEL READ <br /> COMMITED <br /> START TRANSACTION <br /> SELECT * FROM Users WHERE id=1<td> <td>1<tr><td> <td>SET TRANSACTION ISOLATION LEVEL READ <br /> COMMITTED <br /> START TRANSACTION <br /> UPDATE Users SET age=21<td>2<tr><td>SELECT * FROM Users WHERE id=1 <br /> COMMIT;<td> <td>3</table></div><p>T1의 경우 처음에는 age=10을 다루다가 3번 과정에서는 age=21인 값을 가져와 커밋을 진행하게 된다. 즉, 한 트랜잭션 내에서 같은 Key를 가진 Row를 두 번 읽었는데 그 사이에 값이 변경되거나 삭제되어 결과가 다르게 나타나는 현상을 말한다.</p><h3 id="phantom-read">Phantom read</h3><p>T1이 데이터를 읽고 T2가 데이터를 쓸때(Insert) T1이 다시 한번 데이터를 읽을 때 생기는 문제이다. T1이 읽기 작업을 다시한번 반복할 경우 이전에 없던 데이터가 나타나는 현상을 Phantom Read라고 칭한다.</p><div class="table-wrapper"><table><thead><tr><th>트랜잭션 1<th>트랜잭션 2<th>번호<tbody><tr><td>SET TRANSACTION ISOLATION LEVEL <br /> REPEATABLE READ <br /> START TRANSACTION <br /> SELECT * FROM Users WHERE age between 10 and 30<td> <td>1<tr><td> <td>SET TRANSACTION ISOLATION LEVEL READ <br /> COMMITTED <br /> START TRANSACTION <br /> INSERT INTO Users Values(2,’30’); COMMIT;<td>2<tr><td>SELECT * FROM Users WHERE age between 10 and 30 <br /> COMMIT;<td> <td>3</table></div><p>1번에서 하나의 데이터만 읽어왔다면, 3번에서는 2개의 row가 읽어와 진다.</p><blockquote><p>MySql에서는 PhantomRead가 발생하지 않는다. Repeatable READ는 트랜잭션이 처음 데이터를 읽어올 때, SNAPSHOT을 구축하여 자료를 가져오며 그에 따라 자료가 변경되더랄도 동일한 결과를 보여주게 된다.</p></blockquote><blockquote><p>MySQL InnoDB의 default isolation level은 Repeatable READ로 설정되어있다.</p></blockquote><h3 id="고립-수준-명령어">고립 수준 명령어</h3><p>앞서 살펴보았듯, 트랜잭션을 SET하는 문장에서 여러 명령어들이 등장하고 있음을 알 수 있다.</p><blockquote><p>위에서 이야기 하였듯, 아무런 설정을 해주지 않는다면 Repeatable READ로 동작한다 (MySQL)</p></blockquote><p>앞선 <code class="language-plaintext highlighter-rouge">dirty read</code>, <code class="language-plaintext highlighter-rouge">non-repeatable read</code>, <code class="language-plaintext highlighter-rouge">phantom read</code>를 해결하기 위해서는 당연히 락을 사용하는 방법이 존재한다. 하지만 DBMS는 트랜잭션을 동시에 실행시키면서 락보다 좀 더 완화된 방법으로 문제를 해결하는 명령어를 제공한다.</p><ul><li>Read Uncommitted(Lv=0)</ul><p>트랜잭션에서 처리 중인(아직 커밋되지 않은) 데이터를 다른 트랜잭션이 읽는 것을 허용한다. 눈치 챘겠지만, 정합성에 문제를 일으킬 수 있으므로 권장하는 설정이 아니다. 다른 트랜잭션에 공유락과 배타락이 걸린 데이터를 대기하지 않고 읽어온다.</p><p><br /></p><p>또한 자신의 데이터에 아무런 공유 락을 걸지 않는다. 이 명령어는 SELECT 대상이 되는 테이블에 대해 락을 설정하지 않은 것과 같다.</p><blockquote><p>UPDATE 문의 경우에는 갱신 손실 문제때문에 배타락을 걸어야 한다.</p></blockquote><blockquote><p>SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED</p></blockquote><ul><li>Read Committed(Lv=1)</ul><p>트랜잭션이 커밋되어 확정된 데이터만 다른 트랜잭션이 읽도록 허용한다. 이로 인해 Dirty Read를 막을 수 있다. 이외에 다른 트랜잭션 데이터는 락 호환성 규칙에 따라 진행한다.</p><blockquote><p>SET TRANSACTION ISOLATION LEVEL READ COMMITTED</p></blockquote><p>RDB에서 대부분 기본적으로 사용되고 있는 격리수준이다. 실제 테이블 값을 가져오는 것이 아니라, Undo 영역에 백업된 레코드에서 값을 가져오게 된다. 따라서 DirtyRead와 같은 현상은 발생하지 않는다.</p><p><br /></p><p>하지만 아래와 같이 non-repeatable read 문제는 발생할 수 있다.</p><blockquote><p>REPEATABLE READ의 정합성에는 어긋난다.</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sql/2.JPG" /></p><ul><li>REPEATABLE READ(Lv=2)</ul><p>MySQL의 트랜잭션 기본 ISOLATION에 해당한다. 자신의 데이터에 설정된 공유락과 배타락을 트랜잭션이 종료할 때 까지 유지하여 다른 트랜잭션이 자신의 데이터를 갱신할 수 없도록 한다. 다른 격리성 수준에 비해 동시성이 낮아지게 된다.</p><p><br /></p><p>MySQL에서는 앞서 이야기 하였듯, 공유락을 걸지 않고 최초 트랜잭션 SELECT 수행시 SNAPSHOT을 만든 후 그 SNAPSHOT으로 SELECT를 수행하여 다른 트랜잭션의 변경시에도 동일 결과를 유지한다.</p><blockquote><p>SET TRANSACTION ISOLATION LEVEL REPEATABLE READ</p></blockquote><p>변경된 데이터는 Undo 공간에 백업해 두고 실제 레코드 값을 변경한다.</p><blockquote><p>백업된 데이터는 불필요하다고 판단하는 시점에 주기적으로 삭제하지만, 레코드가 많아지면 성능이 떨어지게 된다.</p></blockquote><p><img src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-src="/assets/img/sql/3.JPG" /></p><p>이처럼 Undo에 대한 것은 보류하고, 스냅샷으로 가지고 있던 것들로만 처리를 하기에 Repeatable READ를 보장한다.</p><ul><li>SERIALIZABLE (Lv=3)</ul><p>고립수준이 가장 높은 명령어로, 실행중인 트랜잭션이 다른 트랜잭션으로부터 완벽하게 분리된다. 이 명령어는 네가지 고립화 수준 중 제한이 가장 심하고 데이터의 동시성 또한 제일 낮다.</p><blockquote><p>SELECT 질의의 대상이 되는 데이터 테이블에 미리 배타락을 설정한 것과 같은 효과를 낸다.</p></blockquote><blockquote><p>이때, 인덱스에 공유락을 설정하여 다른 트랜잭션의 Insert문이 금지된다. 이로 인해 PhantomREAD를 막게된다.</p></blockquote><p><strong>하지만 MYSQL에서는 트랜잭션 격리수준을 REPEATABLE READ로 설정해도 스냅샷으로 처리하기 때문에 PHANTOM READ는 발생하지 않는다.</strong></p><h2 id="실제-격리수준에-따른-테스트">실제 격리수준에 따른 테스트</h2><ul><li>예시 1) Non-repeatable Read</ul><p>해당 이슈는 앞서 살펴 보았듯, uncommitted read와 committed read 상황에서 모두 발생할 수 있다. balance의 총합을 검색했을때 1의 결과가 10000원 이라고 해보자.</p><blockquote><p>트랜잭션의 ISOLATION LEVEL을 주의해서 보아야 한다.</p></blockquote><div class="table-wrapper"><table><thead><tr><th>트랜잭션 1<th>트랜잭션 2<th>번호<tbody><tr><td>START TRANSACTION ISOLATION LEVEL <strong>READ COMMITTED</strong> <br /> START TRANSACTION <br /> SELECT SUM(balance) FROM Account<td> <td>1<tr><td> <td>START TRANSACTION ISOLATION LEVEL <strong>READ COMMITTED</strong> <br /> START TRANSACTION <br /> UPDATE Account SET balance = balance + 500 WHERE id=1; COMMIT<td>2<tr><td>SELECT SUM(balance) FROM Account <br /> COMMIT;<td> <td>3</table></div><ul><li>1번 상황에서는 그대로 만원이 검색된다.<li>2번 상황에서는 업데이트 문이 나간다.<li>3번 상황에서는 10500원이 검색된다.</ul><blockquote><p>같은 트랜잭션 내에서 다른 row가 읽힌것이다.</p></blockquote><ul><li>예시 2) Repeatable Read 모드를 적용했을 때</ul><p>위의 반복 불가능 읽기 문제를 방지하려면 ISOLATION LEVEL을 상향하면 된다. T1은 락을 해지하지 않기 때문에 T2가 데이터를 업데이트 하는 것을 막을 수 있다. T2는 UPDATE 문을 실행하려는 순간 대기 상태가 된다.</p><blockquote><p>트랜잭션1은 최초 SELECT 시행시, SNAPSHOT을 만든 후 그 트랜잭션이 COMMIT되기 전까지 최초 SNAPSHOT으로 SELECT를 수행하여 다른 트랜잭션의 동일 컬럼 자료의 변경시에도 결과를 동일하게 유한다.</p></blockquote><div class="table-wrapper"><table><thead><tr><th>트랜잭션 1<th>트랜잭션 2<th>번호<tbody><tr><td>START TRANSACTION ISOLATION LEVEL <strong>REPEATABLE READ</strong> <br /> START TRANSACTION <br /> SELECT SUM(balance) FROM Account<td> <td>1<tr><td> <td>START TRANSACTION ISOLATION LEVEL <strong>READ COMMITTED</strong> <br /> START TRANSACTION <br /> <strong>SET SQL_SAFE_UPDATES=0</strong> <br /> UPDATE Account SET balance = balance + 500 WHERE id=1;<td>2<tr><td>SELECT SUM(balance) FROM Account <br /> COMMIT;<td> <td>3<tr><td> <td>SELECT SUM(balance) FROM Account <br /> COMMIT;<td>4</table></div><p>앞선 예시와 비교했을때 트랜잭션1의 모드만 바꾸었을 뿐이지만, 결과는 달라진다.</p><blockquote><p>1,3 모두 같은 결과 (1만원)를 가져오고, 4에서는 10500원을 가져온다.</p></blockquote><p>SQL_SAFE_UPDATES는 넓은 범위의 SQL을 적용하고자 할 때 내려주는 옵션에 해당한다. 테이블에서는 키 값을 이용한 update나 delete만을 허용하도록 되어 있는데 이러한 safe mode를 해제해주는 것에 해당한다.</p><h1 id="출처">출처</h1><ul><li><a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&amp;ejkGb=KOR&amp;barcode=9791156644576&amp;orderClick=JAK">MYSQL로 배우는 DB이론과 실습</a><li><a href="https://sabarada.tistory.com/117">사바라다는 차곡차곡</a><li><a href="https://nesoy.github.io/articles/2019-05/Database-Transaction-isolation">Nesoy Blog</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/database/'>DataBase</a>, <a href='/categories/sql/'>sql</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/sql/" class="post-tag no-text-decoration" >sql</a> <a href="/tags/lock/" class="post-tag no-text-decoration" >lock</a> <a href="/tags/mysql/" class="post-tag no-text-decoration" >mysql</a> <a href="/tags/database/" class="post-tag no-text-decoration" >database</a> <a href="/tags/transaction/" class="post-tag no-text-decoration" >transaction</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/">CC BY 4.0</a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=DB의 트랜잭션 (3) 트랜잭션의 격리성, LOCK 두번째 - Vitriol&url=https://vitriol95.github.io/posts/mysql3/" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=DB의 트랜잭션 (3) 트랜잭션의 격리성, LOCK 두번째 - Vitriol&u=https://vitriol95.github.io/posts/mysql3/" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://telegram.me/share?text=DB의 트랜잭션 (3) 트랜잭션의 격리성, LOCK 두번째 - Vitriol&url=https://vitriol95.github.io/posts/mysql3/" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i class="fa-fw fas fa-link small" onclick="copyLink()" data-toggle="tooltip" data-placement="top" title="Copy link"></i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down"><div class="access"><div id="access-lastmod" class="post"> <span>Recent Update</span><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/batchbase1/">스프링 배치 - 1 스프링 배치란?</a><li><a href="/posts/batchbase2/">스프링 배치 - 2 DB 스키마에 대한 이해</a><li><a href="/posts/batchbase3/">스프링 배치 - 3 도메인 뜯어보기(JOB)</a><li><a href="/posts/batchbase4/">스프링 배치 - 4 도메인 뜯어보기(STEP)</a><li><a href="/posts/batchbase5/">스프링 배치 - 5 청크 지향 처리</a></ul></div><div id="access-tags"> <span>Trending Tags</span><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">백준</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"> <span class="pl-3 pt-2 mb-2">Contents</span><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="post-extend-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/mysql1/"><div class="card-body"> <span class="timeago small" > Oct 1, 2021 <i class="unloaded">2021-10-01T14:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DB의 트랜잭션 (1) 트랜잭션의 성질</h3><div class="text-muted small"><p> Transaction Transaction은 무엇인지? DBMS에서 데이터를 다루는 논리적인 작업의 단위 에 해당한다. DBMS에서 이렇게 transaction 이라는 작업의 단위를 정의해 둔 이유가 무엇일까? DBMS를 이용해 데이터를 다룰 때 장애가 일어나는 경우가 있는데, 장애 발생시 데이터를 복구하는 작업의 단위가 된다. DB에서...</p></div></div></a></div><div class="card"> <a href="/posts/mysql2/"><div class="card-body"> <span class="timeago small" > Oct 2, 2021 <i class="unloaded">2021-10-02T14:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DB의 트랜잭션 (2) 트랜잭션의 격리성, LOCK</h3><div class="text-muted small"><p> 트랜잭션의 격리성(고립성) ACID 중 I인 고립성 DB의 경우 공유목적이 있기에, 여러 트랜잭션이 동시에 수행 될 수 있다. DB입장에서는 각각의 트랜잭션이 다른 트랜잭션의 방해를 받지 않고 독립적으로 작업을 수행해야 하는 것이다. 이렇게 여러 트랜잭션이 동시 수행될때 간섭이나 충돌이 일어나지 않도록 하는 것을 고립성 이라고 이야기한다. 동시성...</p></div></div></a></div><div class="card"> <a href="/posts/mysql4/"><div class="card-body"> <span class="timeago small" > Oct 4, 2021 <i class="unloaded">2021-10-04T14:00:00+09:00</i> </span><h3 class="pt-0 mt-1 mb-3" data-toc-skip>DB의 트랜잭션 (4) 트랜잭션의 격리성, LOCK 세번째</h3><div class="text-muted small"><p> 비관적 락과 낙관적 락 비관적 락 (Pessimistic) 이전까지 우리가 보았던 락(Lock)의 종류는 모두 비관적락에 해당한다. 이는 Repeatable Read 또는 Serializable 정도의 격리성 수준에서 가능하다. 즉, 트랜잭션이 시작될 때 Shared Lock 혹은 Exclusive Lock을 걸어놓고 시작하는 방법에 해당한다. ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/gradleTask/" class="btn btn-outline-primary" prompt="Older"><p>그래들 태스크 정리</p></a> <a href="/posts/dockerCliend/" class="btn btn-outline-primary" prompt="Newer"><p>도커의 Host - Client 구조</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/username">vitriol</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><h4 class="text-muted mb-4">Trending Tags</h4><a class="post-tag" href="/tags/algorithm/">algorithm</a> <a class="post-tag" href="/tags/python3/">python3</a> <a class="post-tag" href="/tags/boj/">boj</a> <a class="post-tag" href="/tags/problem/">problem</a> <a class="post-tag" href="/tags/%EB%B0%B1%EC%A4%80/">백준</a> <a class="post-tag" href="/tags/spring/">spring</a> <a class="post-tag" href="/tags/springboot/">springboot</a> <a class="post-tag" href="/tags/java/">java</a> <a class="post-tag" href="/tags/spring-mvc/">spring mvc</a> <a class="post-tag" href="/tags/springframework/">springframework</a></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="https://vitriol95.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script>
